<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.0.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/web_icon.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/web_icon.jpg">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/red/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"rain-1796.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"hide","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="村雨的MySQL学习笔记 前言：开学一个月以来，利用零散的时间总算学完了MySQL。当然，也只是初步地学习完一些基本知识，还需加以扩展和练习。 本笔记基于bilibili动力节点的教学视频，主讲人是杜老师，我很喜欢。 相关的学习资料：https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1Mbs1UaRGjxidwvLyBIcXhg 提取码：1796">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL笔记">
<meta property="og:url" content="https://rain-1796.github.io/2024/03/26/MySQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="VillageRain&#39;s blog">
<meta property="og:description" content="村雨的MySQL学习笔记 前言：开学一个月以来，利用零散的时间总算学完了MySQL。当然，也只是初步地学习完一些基本知识，还需加以扩展和练习。 本笔记基于bilibili动力节点的教学视频，主讲人是杜老师，我很喜欢。 相关的学习资料：https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1Mbs1UaRGjxidwvLyBIcXhg 提取码：1796">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-03_11-16-59.png">
<meta property="og:image" content="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-03_11-35-14.png">
<meta property="og:image" content="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-03_11-30-14.png">
<meta property="og:image" content="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-03_21-10-05.png">
<meta property="og:image" content="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-29_23-34-29.png">
<meta property="og:image" content="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-29_23-35-16.png">
<meta property="og:image" content="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-29_23-35-52.png">
<meta property="og:image" content="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-03_21-52-40.png">
<meta property="og:image" content="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-03_21-53-38.png">
<meta property="og:image" content="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-03_21-54-21.png">
<meta property="og:image" content="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-03_22-32-30.png">
<meta property="og:image" content="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-03_22-37-26.png">
<meta property="og:image" content="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-03_22-46-26.png">
<meta property="og:image" content="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-03_22-47-07.png">
<meta property="og:image" content="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-03_22-02-55.png">
<meta property="og:image" content="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-03_22-07-10.png">
<meta property="og:image" content="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-06-04_10-35-19.png">
<meta property="og:image" content="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-25_11-09-21.png">
<meta property="og:image" content="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-26_10-54-44.png">
<meta property="article:published_time" content="2024-03-26T05:18:54.627Z">
<meta property="article:modified_time" content="2024-06-04T04:42:34.476Z">
<meta property="article:author" content="村雨">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-03_11-16-59.png">


<link rel="canonical" href="https://rain-1796.github.io/2024/03/26/MySQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://rain-1796.github.io/2024/03/26/MySQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","path":"2024/03/26/MySQL学习笔记/","title":"MySQL笔记"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>MySQL笔记 | VillageRain's blog</title>
  







<script async src="/lib/fireworks.js"></script>
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">VillageRain's blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Learning</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-text">MySQL</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B8%B8%E8%A7%81%E6%A6%82%E5%BF%B5"><span class="nav-text">1.数据库常见概念</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1%E6%A6%82%E5%BF%B5"><span class="nav-text">1.1概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-SQL%E8%AF%AD%E5%8F%A5%E5%88%86%E7%B1%BB"><span class="nav-text">1.2 SQL语句分类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3MYSQL%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-text">1.3MYSQL中的数据类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4SQL%E8%84%9A%E6%9C%AC%E7%9A%84%E6%89%A7%E8%A1%8C"><span class="nav-text">1.4SQL脚本的执行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-5%E6%95%B0%E6%8D%AE%E5%BA%93%E5%92%8C%E8%A1%A8%E7%9A%84%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA"><span class="nav-text">1.5数据库和表的导入导出</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-6%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-text">1.6数据库常用命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-7%E6%A8%A1%E5%BC%8F"><span class="nav-text">1.7模式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E8%A1%A8%E5%8F%8A%E5%A2%9E%E3%80%81%E5%88%A0%E3%80%81%E6%94%B9"><span class="nav-text">2.表及增、删、改</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E8%A1%A8create"><span class="nav-text">2.1创建一个表create</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2%E5%88%A0%E9%99%A4%E4%B8%80%E4%B8%AA%E8%A1%A8drop"><span class="nav-text">2.2删除一个表drop</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AEinsert"><span class="nav-text">2.3插入数据insert</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AEupdate"><span class="nav-text">2.4修改数据update</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AEdelete"><span class="nav-text">2.5删除数据delete</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-5-1delete"><span class="nav-text">2.5.1delete</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-5-2truncate"><span class="nav-text">2.5.2truncate</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-6%E4%BF%AE%E6%94%B9%E5%9F%BA%E6%9C%AC%E8%A1%A8"><span class="nav-text">2.6修改基本表</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="nav-text">3.表查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1%E7%AE%80%E5%8D%95%E6%9F%A5%E8%AF%A2"><span class="nav-text">3.1简单查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="nav-text">3.2条件查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2"><span class="nav-text">3.3模糊查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4%E6%8E%92%E5%BA%8F"><span class="nav-text">3.4排序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5%E5%8E%BB%E9%87%8Ddistinct"><span class="nav-text">3.5去重distinct</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-6%E5%88%86%E9%A1%B5"><span class="nav-text">3.6分页</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E5%87%BD%E6%95%B0"><span class="nav-text">4.函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1%E5%8D%95%E8%A1%8C%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0"><span class="nav-text">4.1单行处理函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2%E5%88%86%E7%BB%84%E5%87%BD%E6%95%B0"><span class="nav-text">4.2分组函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3group-by"><span class="nav-text">4.3group by</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4%E8%81%94%E5%90%88%E5%88%86%E7%BB%84"><span class="nav-text">4.4联合分组</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5having"><span class="nav-text">4.5having</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-6%E6%80%BB%E7%BB%93sql%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="nav-text">4.6总结sql执行顺序</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2"><span class="nav-text">5.连接查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1%E5%86%85%E8%BF%9E%E6%8E%A5%E4%B9%8B%E7%AD%89%E5%80%BC%E8%BF%9E%E6%8E%A5"><span class="nav-text">5.1内连接之等值连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2%E5%86%85%E8%BF%9E%E6%8E%A5%E4%B9%8B%E9%9D%9E%E7%AD%89%E5%80%BC%E8%BF%9E%E6%8E%A5"><span class="nav-text">5.2内连接之非等值连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3%E5%86%85%E8%BF%9E%E6%8E%A5%E4%B9%8B%E8%87%AA%E8%BF%9E%E6%8E%A5"><span class="nav-text">5.3内连接之自连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="nav-text">5.4外连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-5%E5%A4%9A%E8%A1%A8%E8%BF%9E%E6%8E%A5"><span class="nav-text">5.5多表连接</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-text">6.子查询</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1where%E5%AD%90%E5%8F%A5%E4%B8%AD%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-text">6.1where子句中的子查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2from%E5%AD%90%E5%8F%A5%E4%B8%AD%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-text">6.2from子句中的子查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3%E5%B8%A6%E6%9C%89exists%E8%B0%93%E8%AF%8D%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-text">6.3带有exists谓词的子查询</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-union%E7%9A%84%E7%94%A8%E6%B3%95"><span class="nav-text">7.union的用法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-%E7%BA%A6%E6%9D%9F"><span class="nav-text">8.约束</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-1%E7%BA%A6%E6%9D%9F%E7%B1%BB%E5%9E%8B"><span class="nav-text">8.1约束类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-2not-null"><span class="nav-text">8.2not null</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-3unique"><span class="nav-text">8.3unique</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#8-3-1%E8%81%94%E5%90%88%E5%94%AF%E4%B8%80"><span class="nav-text">8.3.1联合唯一</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-4primary-key"><span class="nav-text">8.4primary key</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#8-4-1%E5%A4%8D%E5%90%88%E4%B8%BB%E9%94%AE"><span class="nav-text">8.4.1复合主键</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-4-2%E4%B8%BB%E9%94%AE%E8%87%AA%E5%A2%9E"><span class="nav-text">8.4.2主键自增</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-5foreign-key"><span class="nav-text">8.5foreign key</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="nav-text">9.存储引擎</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-1mysql%E6%94%AF%E6%8C%81%E7%9A%84%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="nav-text">9.1mysql支持的存储引擎</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-2MyISAM%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="nav-text">9.2MyISAM存储引擎</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-3InnoDB%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="nav-text">9.3InnoDB存储引擎</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-4MEMORY%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="nav-text">9.4MEMORY存储引擎</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-%E4%BA%8B%E5%8A%A1"><span class="nav-text">10.事务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#10-1InnoDB%E5%AE%9E%E7%8E%B0%E4%BA%8B%E5%8A%A1"><span class="nav-text">10.1InnoDB实现事务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-2%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%9B%9B%E4%B8%AA%E7%89%B9%E6%80%A7"><span class="nav-text">10.2事务的四个特性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-3%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%9A%94%E7%A6%BB%E6%80%A7"><span class="nav-text">10.3事务的隔离性</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#10-3-1%E4%BA%8B%E5%8A%A1%E4%B8%8E%E4%BA%8B%E5%8A%A1%E4%B9%8B%E9%97%B4%E7%9A%84%E5%9B%9B%E4%B8%AA%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="nav-text">10.3.1事务与事务之间的四个隔离级别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#10-3-2%E9%AA%8C%E8%AF%81%E5%90%84%E7%A7%8D%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="nav-text">10.3.2验证各种隔离级别</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-%E7%B4%A2%E5%BC%95"><span class="nav-text">11.索引</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#11-1%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%9B%E5%BB%BA%E5%92%8C%E5%88%A0%E9%99%A4"><span class="nav-text">11.1索引的创建和删除</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-2%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88"><span class="nav-text">11.2索引失效</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-%E8%A7%86%E5%9B%BE"><span class="nav-text">12.视图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#12-1%E8%A7%86%E5%9B%BE%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="nav-text">12.1视图的作用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-2%E8%A7%86%E5%9B%BE%E5%9C%A8%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="nav-text">12.2视图在开发中的作用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%89%E8%8C%83%E5%BC%8F"><span class="nav-text">13.数据库三范式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#13-1%E7%AC%AC%E4%B8%80%E8%8C%83%E5%BC%8F"><span class="nav-text">13.1第一范式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-2%E7%AC%AC%E4%BA%8C%E8%8C%83%E5%BC%8F"><span class="nav-text">13.2第二范式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-3%E7%AC%AC%E4%B8%89%E8%8C%83%E5%BC%8F"><span class="nav-text">13.3第三范式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-DBA%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-text">14.DBA常用命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-%E8%87%AA%E4%B8%BB%E5%AD%98%E5%8F%96%E6%8E%A7%E5%88%B6"><span class="nav-text">15.自主存取控制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#15-1%E6%8E%88%E4%BA%88%E6%9D%83%E9%99%90grant"><span class="nav-text">15.1授予权限grant</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#15-2%E6%94%B6%E5%9B%9E%E6%9D%83%E9%99%90revoke"><span class="nav-text">15.2收回权限revoke</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#15-3%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%9D%83%E9%99%90"><span class="nav-text">15.3创建数据库的权限</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#15-4%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A7%92%E8%89%B2"><span class="nav-text">15.4数据库角色</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="村雨"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">村雨</p>
  <div class="site-description" itemprop="description">当青春远去，愿智慧已足够。</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">44</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/rain-1796" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;rain-1796" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:1796245865@qq.com" title="E-Mail → mailto:1796245865@qq.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://rain-1796.github.io/2024/03/26/MySQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="村雨">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VillageRain's blog">
      <meta itemprop="description" content="当青春远去，愿智慧已足够。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="MySQL笔记 | VillageRain's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          MySQL笔记
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-03-26 13:18:54" itemprop="dateCreated datePublished" datetime="2024-03-26T13:18:54+08:00">2024-03-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-06-04 12:42:34" itemprop="dateModified" datetime="2024-06-04T12:42:34+08:00">2024-06-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">编程学习</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>37k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1:28</span>
    </span>
</div>

        </div>
      </header>

    
    
    

    <div class="post-body" itemprop="articleBody"><p><strong>村雨的MySQL学习笔记</strong></p>
<p>前言：开学一个月以来，利用零散的时间总算学完了MySQL。当然，也只是初步地学习完一些基本知识，还需加以扩展和练习。</p>
<p>本笔记基于bilibili动力节点的教学视频，主讲人是杜老师，我很喜欢。</p>
<p>相关的学习资料：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1Mbs1UaRGjxidwvLyBIcXhg">https://pan.baidu.com/s/1Mbs1UaRGjxidwvLyBIcXhg</a><br>
提取码：1796</p>
<span id="more"></span>
<hr>
<h1>MySQL</h1>
<h2 id="1-数据库常见概念"><a class="header-anchor" href="#1-数据库常见概念">¶</a>1.数据库常见概念</h2>
<h3 id="1-1概念"><a class="header-anchor" href="#1-1概念">¶</a>1.1概念</h3>
<p><strong>数据库</strong>：DataBase，简称<strong>DB</strong>。按照一定格式存储数据的一些文件的组合。</p>
<p>顾名思义：存储数据的仓库，实际上就是一堆文件。这些文件中存储了具有特定格式的数据。</p>
<p><strong>数据库管理系统</strong>：DataBaseManagement，简称<strong>DBMS</strong>。</p>
<p>数据库管理系统专门用来管理数据库中的数据，可以对数据进行<strong>增删改查。</strong></p>
<p><strong>常见的数据库管理系统</strong>：MySQL、Oracle、MS SqlServer、DB2、sybase等…</p>
<p><strong>SQL</strong>：结构化查询<strong>语言</strong></p>
<p>程序员需要学习SQL语句，学会编写SQL语句，然后DBMS负责执行SQL语句，最终来完成在数据库中对数据的增删改查操作。</p>
<p>SQL是一套标准，这个SQL在mysql中可以使用，同时在Oracle中也可以使用，还可以在DB2中使用。</p>
<p><strong>三者之间的关系？</strong><br>
DBMS—&gt;执行SQL —&gt;操作DB</p>
<h3 id="1-2-SQL语句分类"><a class="header-anchor" href="#1-2-SQL语句分类">¶</a>1.2 SQL语句分类</h3>
<p><strong>DQL</strong>：数据<strong>查询</strong>语言（凡是<strong>带有select关键字</strong>的都是查询语句）select…</p>
<p><strong>DML</strong>：数据<strong>操作</strong>语言（凡是对表当中的数据进行<strong>增删改</strong>的都是DML）</p>
<p>insert增   delete删    update改</p>
<p>主要是操作表中的数据。</p>
<p><strong>DDL</strong>：数据定义语言（凡是带有<strong>create、drop、alter</strong>的都是DDL）</p>
<p>DDL主要操作的是<strong>表的结构</strong>，不是表中的数据。</p>
<p>create：新建，等同于增   drop：删除   alter：修改<br>
（这个增删改和DML不同，这个主要是对<strong>表结构</strong>进行操作）</p>
<p><strong>TCL</strong>：事务控制语言</p>
<p>事务提交：commit;<br>
事务回滚：rollback;</p>
<p><strong>DCL</strong>：数据控制语言。</p>
<p>授权：grant  撤销权限：revoke</p>
<h3 id="1-3MYSQL中的数据类型"><a class="header-anchor" href="#1-3MYSQL中的数据类型">¶</a>1.3MYSQL中的数据类型</h3>
<p><strong>varchar(最长255)</strong>: <strong>可变长度的字符串</strong>，比较智能，节省空间。会根据实际的数据长度动态分配空间。</p>
<p>优点：节省空间<br>
​		缺点：需要动态分配空间，<strong>速度慢</strong>。</p>
<p><strong>char(最长255)</strong><br>
:<strong>定长字符串</strong>，不管实际的数据长度是多少，分配固定长度的空间去存储数据。</p>
<p>优点：不需要动态分配空间，<strong>速度快。</strong><br>
​		缺点：使用不当可能会导致空间的浪费。</p>
<p><strong>varchar和char应该怎么选择？</strong><br>
​</p>
<p>性别字段选什么？因为性别是固定长度的字符串，所以选择char。<br>
​</p>
<p>姓名字段选什么？每一个人的名字长度不同，所以选择varchar。</p>
<p><strong>int(最长11)</strong>：数字中的整数型。等同于java中的int。</p>
<p><strong>bigint</strong>：数字中的长整型。等同于java中的long。</p>
<p><strong>float</strong>：单精度浮点型数据</p>
<p><strong>double</strong>：双精度浮点型数据</p>
<hr>
<p><strong>date</strong>：短日期类型</p>
<p><strong>datetime</strong>：长日期类型</p>
<p>date是<strong>短日期</strong>，默认为：%Y%m%d（<strong>年月日</strong>），datetime为<strong>长日期</strong>，默认为：%Y%m%d %h:%i:%s（<strong>年月日时分秒</strong>）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">例如：<span class="type">date</span>：<span class="string">&#x27;2024-05-23&#x27;</span>    datetime：<span class="string">&#x27;2024-05-23 11:17:23&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> datediff(now(),datetime) <span class="keyword">from</span> t_lend <span class="keyword">where</span> <span class="keyword">no</span> <span class="operator">=</span> <span class="number">6</span>; <span class="comment">-- 获得目标时间与当前时间的差值，返回天数</span></span><br></pre></td></tr></table></figure>
<hr>
<p><strong>clob</strong>：字符大对象，最多可以存储4G的字符串。（Character Large OBject）</p>
<p>比如：<strong>存储一篇文章</strong>，存储一个说明。<strong>超过255个字符的</strong>都要采用CLOB字符大对象来存储。</p>
<p><strong>blob</strong>：二进制大对象，专门用来<strong>存储图片、声音、视频等流媒体数据</strong>。（Binary Large OBject）</p>
<p>往BLOB类型的字段上插入数据的时候，例如插入一个图片、视频等等，需要使用IO流才行。</p>
<p>表中数据类型的使用：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">t_movie 电影表（专门存储电影信息的表）</span><br><span class="line">编号<span class="keyword">no</span>(<span class="type">bigint</span>)   名字name(<span class="type">varchar</span>)   故事情节storyplot(<span class="type">clob</span>)	</span><br><span class="line">上映日期playtime(<span class="type">date</span>)   时长<span class="type">time</span>(<span class="keyword">double</span>)   海报image(<span class="type">blob</span>)</span><br><span class="line">类型type(<span class="type">char</span>)							</span><br></pre></td></tr></table></figure>
<h3 id="1-4SQL脚本的执行"><a class="header-anchor" href="#1-4SQL脚本的执行">¶</a>1.4SQL脚本的执行</h3>
<p>xxxx.sql这种文件被称为sql脚本文件，其中编写了大量的sql语句。</p>
<p>我们执行sql脚本文件的时候，该文件中所有的sql语句会全部执行。</p>
<p>批量执行SQL语句，可以使用sql脚本文件。</p>
<p>mysql&gt; <code>source</code> D:\course\03-MySQL\document\vip.sql</p>
<p>比如你在实际的工作中，第一天到公司，项目经理会给你一个xxx.sql文件，你执行这个脚本文件，你电脑上的数据库数据就有了。</p>
<h3 id="1-5数据库和表的导入导出"><a class="header-anchor" href="#1-5数据库和表的导入导出">¶</a>1.5数据库和表的导入导出</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 数据导出：</span></span><br><span class="line">	在windows的dos命令窗口中：</span><br><span class="line">		mysqldump bjpowernode<span class="operator">&gt;</span>D:\bjpowernode.sql <span class="operator">-</span>uroot <span class="operator">-</span>p123456</span><br><span class="line">	可以导出指定的表吗？</span><br><span class="line">		mysqldump bjpowernode emp<span class="operator">&gt;</span>D:\bjpowernode.sql <span class="operator">-</span>uroot <span class="operator">-</span>p123456 <span class="comment">-- 导出emp表</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 数据导入：</span></span><br><span class="line">	注意：需要先登录到mysql数据库服务器上。</span><br><span class="line">	创建数据库：<span class="keyword">create</span> database bjpowernode;</span><br><span class="line">	使用数据库：use bjpowernode;</span><br><span class="line">	然后初始化数据库：source D:\bjpowernode.sql (拉取)</span><br></pre></td></tr></table></figure>
<h3 id="1-6数据库常用命令"><a class="header-anchor" href="#1-6数据库常用命令">¶</a>1.6数据库常用命令</h3>
<p><strong>exit</strong> --退出数据库</p>
<p><strong>show databases;</strong> --查看mysql中有哪些数据库。(mysql自带四个数据库)</p>
<p><img src="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-03_11-16-59.png" alt=""></p>
<p><strong>use test;</strong> --表示正在使用一个名字叫做test的数据库。</p>
<p><strong>create database 数据库名;</strong> --创建数据库</p>
<p><strong>show tables;</strong> --查看某个数据库下有哪些表。（mysql自带很多张表）</p>
<img src="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-03_11-35-14.png" style="zoom: 50%;" />
<p><strong>select * from 表名;</strong> --查看表中所有数据</p>
<p><strong>desc 表名;</strong> -查看表的结构</p>
<p><strong>select version();</strong> --查看mysql数据库的版本号</p>
<p><strong>select database();</strong> --查看当前使用的是哪个数据库</p>
<p><strong>\c</strong> --用来<strong>终止</strong>一条命令的输入。</p>
<p><strong>注意</strong>：不区分大小写</p>
<hr>
<p><strong>SQL中的注释语句（三种）</strong></p>
<p>一、<strong>单行注释</strong><br>
采用 “–”(双减号)进行单行注释，注意：&quot;–&quot;与注释内容<strong>要用空格隔开</strong>才会生效</p>
<p>二、<strong>多行注释</strong><br>
采用 /<em>…</em>/进行多行注释</p>
<p>三，（单行）注释<br>
在mysql数据库中就可使用&quot;#&quot;进行单行注释。</p>
<p>&quot;#&quot;与注释内容之间有没有空格注释效果都会生效。</p>
<p>除此之外，数据库可视化管理工具SQLyog如果连接的是mysql数据库，而mysql数据库支持SQL，那么mysql就支持使用SQL标准注释和&quot;#“注释，那么在SQLyog中也就可以使用SQL标准注释和”#&quot;注释。</p>
<h3 id="1-7模式"><a class="header-anchor" href="#1-7模式">¶</a>1.7模式</h3>
<p><strong>一个数据库中可以建立多个模式</strong>，一个模式下通常包含多个表、视图和索引等数据库对象。</p>
<p>对于<strong>模式的理解</strong>：</p>
<p>例如你的数据库里面有很多的表。就以一个学校作为例子吧：</p>
<p>有很多表分别用于存储学生、课程、成绩、学分等信息。</p>
<p>还有很多表用于存储 老师、工资、奖金等信息。</p>
<p>还有很多表用于存储学校的固定资产、流动资产、财务相关信息。</p>
<p>如果这么多的表，都混杂在一起。管理起来非常麻烦。</p>
<p>通过 create schema ， 划分区域，</p>
<p>把学生的，创建一个 schema 叫 <strong>Student</strong></p>
<p>教师的，创建一个 schema 叫 <strong>Teacher</strong></p>
<p>学校财务的，创建一个 schema 叫 <strong>School</strong></p>
<p>这样，对于专门负责学生信息管理的，就只负责 Student 这个 schema，表名全部是 <strong>Student.具体表名</strong>。</p>
<p>对于，负责教师系统开发的人来说，程序里面的表名，都是<strong>Teacher.具体表名</strong>。</p>
<p>学校财务的也是一样，查询的时候，是：SELECT * FROM <strong>School.具体表名</strong>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1.定义模式</span></span><br><span class="line"><span class="keyword">create</span> schema <span class="operator">&lt;</span>模式名<span class="operator">&gt;</span> <span class="keyword">authorization</span> <span class="operator">&lt;</span>用户名<span class="operator">&gt;</span>;</span><br><span class="line"><span class="comment">-- 如果没有指定模式名，默认为用户名</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2.删除模式</span></span><br><span class="line"><span class="keyword">drop</span> schema <span class="operator">&lt;</span>模式名<span class="operator">&gt;</span> cascade(级联)<span class="operator">/</span>restrict(限制);</span><br><span class="line"><span class="comment">-- 使用级联：表示在删除模式的同时把该模式下所有的数据库对象都删除</span></span><br><span class="line"><span class="comment">-- 使用限制：只有在该模式下没有任何数据库对象时才能执行删除语句</span></span><br><span class="line"><span class="comment">-- 后续的删除表同理</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3.在某个模式下创建表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>模式名<span class="operator">&gt;</span>.<span class="operator">&lt;</span>表名<span class="operator">&gt;</span>(</span><br><span class="line">	<span class="operator">&lt;</span>列名<span class="operator">&gt;</span> <span class="operator">&lt;</span>数据类型<span class="operator">&gt;</span> [列级完整约束性条件],</span><br><span class="line">	<span class="operator">&lt;</span>列名<span class="operator">&gt;</span> <span class="operator">&lt;</span>数据类型<span class="operator">&gt;</span> [列级完整约束性条件],</span><br><span class="line">	...</span><br><span class="line">	[表级完整约束性条件]</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>当我们用Create User创建数据库用户时，我们可以为该用户指定一个已经存在的Schema作为默认Schema，</p>
<p>如果我们不指定，则该用户所默认的Schema即为dbo模式。</p>
<h2 id="2-表及增、删、改"><a class="header-anchor" href="#2-表及增、删、改">¶</a>2.表及增、删、改</h2>
<p>数据库中最基本的单元是表：<strong>table</strong></p>
<p>任何一张表都有行和列</p>
<p><img src="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-03_11-30-14.png" alt=""></p>
<p>行（row）：数据\记录</p>
<p>列（column）：字段</p>
<hr>
<p>自己导入的<strong>bjpowernode表</strong>：</p>
<img src="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-03_21-10-05.png" style="zoom:67%;" />
<p><strong>emp员工表</strong>：</p>
<p><img src="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-29_23-34-29.png" alt=""></p>
<p>EMPNO：员工编号   ENAME：姓名   JOB：岗位   MGR：上级领导编号</p>
<p>HIREDATE：入职日期   SAL：工资   COMM：津贴   DEPTNO：部门编号</p>
<p><strong>dept部门表</strong>：</p>
<p><img src="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-29_23-35-16.png" alt=""></p>
<p>DEPTNO：部门编号   DNAME：部门名称   LOC：部门地点</p>
<p><strong>salgrade工资等级表</strong>：</p>
<p><img src="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-29_23-35-52.png" alt=""></p>
<p>GRADE：工资等级   LOSAL：最低工资   HISAL：最高工资</p>
<hr>
<p>以上三个表的结构：</p>
<p><strong>emp员工表</strong>：</p>
<p><img src="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-03_21-52-40.png" alt=""></p>
<p><strong>dept部门表</strong>：</p>
<p><img src="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-03_21-53-38.png" alt=""></p>
<p><strong>salgrade工资表</strong>：</p>
<p><img src="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-03_21-54-21.png" alt=""></p>
<hr>
<p>给查询的<strong>列起别名</strong>：<strong>select 原名 as 别名 from dept;</strong> （as关键字也可以省略，用空格代替）</p>
<p>例如将dname改为supername</p>
<p><img src="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-03_22-32-30.png" alt=""></p>
<p><strong>注意</strong>：只是将查询后表的结果修改，原表不会发生实际变化。<strong>select永远不能进行实质的修改操作</strong>。</p>
<p><img src="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-03_22-37-26.png" alt=""></p>
<p>若<strong>别名中含有空格或者别名是中文</strong>，会编译错误。</p>
<p>解决方法：将别名用<strong>单引号</strong>括住（数据库标准），也可以使用双引号（在mysql中可以使用）。</p>
<hr>
<p><strong>字段参与数学运算</strong></p>
<img src="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-03_22-46-26.png" style="zoom:50%;" />
<p>将工资乘12：</p>
<img src="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-03_22-47-07.png" style="zoom:50%;" />
<hr>
<h3 id="2-1创建一个表create"><a class="header-anchor" href="#2-1创建一个表create">¶</a>2.1创建一个表create</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 学号、姓名、年龄、性别、邮箱地址</span></span><br><span class="line">	<span class="keyword">create</span> <span class="keyword">table</span> t_student(</span><br><span class="line">		<span class="keyword">no</span> <span class="type">int</span>,</span><br><span class="line">		name <span class="type">varchar</span>(<span class="number">32</span>),</span><br><span class="line">		sex <span class="type">char</span>(<span class="number">1</span>),</span><br><span class="line">		age <span class="type">int</span>(<span class="number">3</span>),</span><br><span class="line">		email <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">	);</span><br><span class="line"><span class="comment">-- 完整性约束在第八部分具体解释</span></span><br></pre></td></tr></table></figure>
<p>（<strong>以下内容了解即可</strong>）</p>
<p>快速创建表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp2 <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>
<p>将一个查询结果当做一张新建的表，可以实现表的快速复制。</p>
<p>将查询结果直接插入到一张表中：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp2 <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>
<h3 id="2-2删除一个表drop"><a class="header-anchor" href="#2-2删除一个表drop">¶</a>2.2删除一个表drop</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 当这张表不存在的时候会报错！</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> t_student;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 如果这张表存在的话，删除</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> t_student; <span class="comment">-- 即使表不存在也不会报错</span></span><br></pre></td></tr></table></figure>
<p>对表结构的修改需要使用：<strong>alter</strong>-属于DDL语句</p>
<p><strong>desc</strong> t_student    查看表结构</p>
<h3 id="2-3插入数据insert"><a class="header-anchor" href="#2-3插入数据insert">¶</a>2.3插入数据insert</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> 表名(字段名<span class="number">1</span>,字段名<span class="number">2</span>,字段名<span class="number">3.</span>..) <span class="keyword">values</span>(值<span class="number">1</span>,值<span class="number">2</span>,值<span class="number">3</span>); <span class="comment">-- 字段名和值要对应</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_student(<span class="keyword">no</span>,name,sex,age,email)</span><br><span class="line">	<span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;zhangsan&#x27;</span>,<span class="string">&#x27;m&#x27;</span>,<span class="number">20</span>,<span class="string">&#x27;zhangsan@123.com&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_student(email,name,sex,age,<span class="keyword">no</span>) <span class="comment">-- 可以乱序,但要一一对应</span></span><br><span class="line">	<span class="keyword">values</span>(<span class="string">&#x27;lisi@123.com&#x27;</span>,<span class="string">&#x27;lisi&#x27;</span>,<span class="string">&#x27;f&#x27;</span>,<span class="number">20</span>,<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_student(<span class="keyword">no</span>) <span class="keyword">values</span>(<span class="number">3</span>); <span class="comment">-- 只插入一个字段</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_student <span class="keyword">values</span>(<span class="number">2</span>, <span class="string">&#x27;lisi&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="number">20</span>, <span class="string">&#x27;lisi@123.com&#x27;</span>); <span class="comment">-- 省略字段名，但是值要全部写出来</span></span><br></pre></td></tr></table></figure>
<p>insert语句一旦执行成功了，必然会多一条记录。没有给其它字段指定值的话，<strong>默认值是NULL</strong>。</p>
<p><strong>一次插入多条数据</strong></p>
<p>insert into t_user(字段名1,字段名2) values(),(),(),();</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_user( <span class="comment">-- 建一个新表t_user</span></span><br><span class="line">    id <span class="type">int</span>,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">32</span>),</span><br><span class="line">    birth <span class="type">date</span>, <span class="comment">-- 日期类型，默认：%Y%m%d（年月日）   日期格式：1980-10-11</span></span><br><span class="line">    create_time datetime</span><br><span class="line">);</span><br><span class="line">    </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_user(id,name,birth,create_time) <span class="keyword">values</span> <span class="comment">-- 插入三条数据</span></span><br><span class="line">		(<span class="number">1</span>,<span class="string">&#x27;zs&#x27;</span>,<span class="string">&#x27;1980-10-11&#x27;</span>,now()), </span><br><span class="line">		(<span class="number">2</span>,<span class="string">&#x27;lisi&#x27;</span>,<span class="string">&#x27;1981-10-11&#x27;</span>,now()),</span><br><span class="line">		(<span class="number">3</span>,<span class="string">&#x27;wangwu&#x27;</span>,<span class="string">&#x27;1982-10-11&#x27;</span>,now());</span><br></pre></td></tr></table></figure>
<p>数据库命名规范：所有的标识符都用小写字母，单词与单词之间用下划线衔接。</p>
<p>date是<strong>短日期</strong>，默认为：%Y%m%d（<strong>年月日</strong>），datetime为<strong>长日期</strong>，默认为：%Y%m%d %h:%i:%s（<strong>年月日时分秒</strong>）</p>
<h3 id="2-4修改数据update"><a class="header-anchor" href="#2-4修改数据update">¶</a>2.4修改数据update</h3>
<p>update 表名 set 字段名1=值1,字段名2=值2,字段名3=值3… where 条件;</p>
<p>若没有<strong>where条件限制</strong>，会导致对应字段的数据全部更新。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> t_user <span class="keyword">set</span> name <span class="operator">=</span> <span class="string">&#x27;jack&#x27;</span>, birth <span class="operator">=</span> <span class="string">&#x27;2000-10-11&#x27;</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">update</span> t_user <span class="keyword">set</span> name <span class="operator">=</span> <span class="string">&#x27;jack&#x27;</span>, birth <span class="operator">=</span> <span class="string">&#x27;2000-10-11&#x27;</span>, create_time <span class="operator">=</span> now() <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>
<h3 id="2-5删除数据delete"><a class="header-anchor" href="#2-5删除数据delete">¶</a>2.5删除数据delete</h3>
<p><strong>delete</strong>语句删除数据的原理：</p>
<p>表中的数据被删除了，但是这个数据在硬盘上<strong>真实的存储空间不会被释放。</strong></p>
<p>缺点是：删除效率比较低。</p>
<p>优点是：<strong>支持回滚rollback</strong>，后悔了可以恢复数据。</p>
<p><strong>truncate</strong>语句删除数据的原理：</p>
<p>这种删除效率比较高，表被一次截断，物理删除。</p>
<p>缺点：不支持回滚rollback。</p>
<p>优点：快速删除。</p>
<h4 id="2-5-1delete"><a class="header-anchor" href="#2-5-1delete">¶</a>2.5.1delete</h4>
<p>delete from 表名 where 条件;</p>
<p>没有条件，整张表的数据会全部删除！</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> t_user <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>
<h4 id="2-5-2truncate"><a class="header-anchor" href="#2-5-2truncate">¶</a>2.5.2truncate</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> emp2; <span class="comment">-- （属于DDL操作。）</span></span><br></pre></td></tr></table></figure>
<h3 id="2-6修改基本表"><a class="header-anchor" href="#2-6修改基本表">¶</a>2.6修改基本表</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1.增加一列，其数据类型为字符型</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> Student <span class="keyword">add</span> Semail <span class="type">varchar</span>(<span class="number">30</span>);</span><br><span class="line"><span class="comment">-- 2.修改某个字段的数据类型</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> Student <span class="keyword">alter</span> <span class="keyword">column</span> Sbirthdate type <span class="type">varchar</span>(<span class="number">20</span>);</span><br><span class="line"><span class="comment">-- 3.为某个字段增加唯一性约束</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> Course <span class="keyword">add</span> <span class="keyword">unique</span>(Cname);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 其他</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">column</span> <span class="comment">-- 删除某一列</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">constraint</span> <span class="comment">-- 删除指定的完整性约束</span></span><br><span class="line">rename <span class="keyword">column</span> <span class="comment">-- 修改字段名</span></span><br></pre></td></tr></table></figure>
<h2 id="3-表查询"><a class="header-anchor" href="#3-表查询">¶</a>3.表查询</h2>
<h3 id="3-1简单查询"><a class="header-anchor" href="#3-1简单查询">¶</a>3.1简单查询</h3>
<p><strong>select  字段  from  表名;</strong></p>
<p>例如查询部门名称：</p>
<p><img src="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-03_22-02-55.png" alt=""></p>
<p><strong>查询多个字段</strong>：<strong>select  字段1,字段2，字段3…  from  表名;</strong></p>
<p>例如查询部门编号和部门名称：</p>
<p><img src="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-03_22-07-10.png" alt=""></p>
<p><strong>查询所有字段</strong>：<strong>select * from 表名;</strong>（效率低，可读性差，实际开发中不建议）</p>
<hr>
<h3 id="3-2条件查询"><a class="header-anchor" href="#3-2条件查询">¶</a>3.2条件查询</h3>
<p><strong>where</strong> 后接条件语句</p>
<p><strong>= 等于</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询薪资等于800的员工姓名和编号：</span></span><br><span class="line">		<span class="keyword">select</span> empno,ename <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="operator">=</span> <span class="number">800</span>;</span><br><span class="line"><span class="comment">-- 查询SMITH的编号和薪资：</span></span><br><span class="line">		<span class="keyword">select</span> empno,sal <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="operator">=</span> <span class="string">&#x27;SMITH&#x27;</span>; <span class="operator">/</span><span class="operator">/</span>字符串使用单引号</span><br></pre></td></tr></table></figure>
<p><strong>&lt;&gt;或!= 不等于</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询薪资不等于800的员工姓名和编号：</span></span><br><span class="line">	<span class="keyword">select</span> empno,ename <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="operator">!=</span> <span class="number">800</span>;</span><br><span class="line">	<span class="keyword">select</span> empno,ename <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="operator">&lt;&gt;</span> <span class="number">800</span>; <span class="operator">/</span><span class="operator">/</span> 小于号和大于号组成的不等号</span><br></pre></td></tr></table></figure>
<p><strong>&lt; 小于</strong>  <strong>&lt;= 小于等于</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询薪资小于等于3000的员工姓名和编号：</span></span><br><span class="line">		<span class="keyword">select</span> empno,ename,sal <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="operator">&lt;=</span> <span class="number">3000</span>;</span><br></pre></td></tr></table></figure>
<p>**&gt; 大于 ** <strong>&gt;= 大于等于</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询薪资大于等于3000的员工姓名和编号：</span></span><br><span class="line"><span class="keyword">select</span> empno,ename,sal <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="operator">&gt;=</span> <span class="number">3000</span>;</span><br></pre></td></tr></table></figure>
<p><strong>between … and …  在两个值之间, 等同于 &gt;= and &lt;=</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询薪资在2450和3000之间的员工信息：（包括2450和3000）</span></span><br><span class="line"><span class="comment">-- 第一种方式：&gt;= and &lt;=</span></span><br><span class="line">		<span class="keyword">select</span> empno,ename,sal <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="operator">&gt;=</span> <span class="number">2450</span> <span class="keyword">and</span> sal <span class="operator">&lt;=</span> <span class="number">3000</span>;</span><br><span class="line"><span class="comment">-- 第二种方式：between … and …	</span></span><br><span class="line">        <span class="keyword">select</span> empno,ename,sal <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="keyword">between</span> <span class="number">2450</span> <span class="keyword">and</span> <span class="number">3000</span>;</span><br><span class="line">        （必须遵循左小右大）</span><br></pre></td></tr></table></figure>
<p><strong>is null 为空（is not null 不为空）</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询哪些员工的津贴/补助为null：</span></span><br><span class="line">		<span class="keyword">select</span> empno,ename,sal,comm <span class="keyword">from</span> emp <span class="keyword">where</span> comm <span class="keyword">is</span> <span class="keyword">null</span>;</span><br><span class="line"><span class="comment">-- 查询哪些员工的津贴/补助不为null：</span></span><br><span class="line">		<span class="keyword">select</span> empno,ename,sal,comm <span class="keyword">from</span> emp <span class="keyword">where</span> comm <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>;</span><br><span class="line">		（使用 <span class="keyword">is</span> ，不可以使用 ... <span class="operator">=</span> <span class="keyword">null</span>）</span><br></pre></td></tr></table></figure>
<p><strong>and 并且  、or 或者</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询薪资大于2500，并且部门编号为10或20的员工：</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp </span><br><span class="line"><span class="keyword">where</span> sal <span class="operator">&gt;</span> <span class="number">2500</span> <span class="keyword">and</span> (deptno <span class="operator">=</span> <span class="number">10</span> <span class="keyword">or</span> deptno <span class="operator">=</span> <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- and和or同时出现，and优先级较高。如果想让or先执行，需要加“小括号”,以后在开发中，如果不确定优先级，就加小括号就行了。</span></span><br></pre></td></tr></table></figure>
<p><strong>in 包含，相当于 or ; not in 不包含</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询工作岗位是MANAGER或者是SALESMAN的员工:</span></span><br><span class="line"><span class="keyword">select</span> empno,ename,job <span class="keyword">from</span> emp <span class="keyword">where</span> job <span class="operator">=</span> <span class="string">&#x27;MANAGER&#x27;</span> <span class="keyword">or</span> job <span class="operator">=</span> <span class="string">&#x27;SALESMAN&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> empno,ename,job <span class="keyword">from</span> emp <span class="keyword">where</span> job <span class="keyword">in</span>(<span class="string">&#x27;MANAGER&#x27;</span>, <span class="string">&#x27;SALESMAN&#x27;</span>);<span class="operator">/</span><span class="operator">/</span>依旧是或者的意思</span><br><span class="line"><span class="comment">-- 查询工作岗位不是MANAGER或者不是SALESMAN的员工:</span></span><br><span class="line"><span class="keyword">select</span> empno,ename,job <span class="keyword">from</span> emp <span class="keyword">where</span> job <span class="keyword">not</span> <span class="keyword">in</span>(<span class="string">&#x27;MANAGER&#x27;</span>, <span class="string">&#x27;SALESMAN&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p><strong>not 取非，主要用在 is 或 in 中</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">is</span> <span class="keyword">null</span></span><br><span class="line"><span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line"><span class="keyword">in</span></span><br><span class="line"><span class="keyword">not</span> <span class="keyword">in</span></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="3-3模糊查询"><a class="header-anchor" href="#3-3模糊查询">¶</a>3.3模糊查询</h3>
<p><strong>like</strong>;<strong>not like</strong></p>
<p>模糊查询支持**%或下划线**匹配</p>
<p>%匹配任意<strong>多个</strong>字符</p>
<p>下划线：任意<strong>一个</strong>字符。</p>
<p>（%是一个特殊符号，_ 也是一个特殊符号）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">找出名字中含有O的：</span><br><span class="line">	<span class="keyword">select</span> ename <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="keyword">like</span> <span class="string">&#x27;%O%&#x27;</span>;</span><br><span class="line">找出名字中第二个字母是A的：</span><br><span class="line">    <span class="keyword">select</span> ename <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="keyword">like</span> <span class="string">&#x27;_A%&#x27;</span>;</span><br><span class="line">找出名字中以K开始的：</span><br><span class="line">    <span class="keyword">select</span> ename <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="keyword">like</span> <span class="string">&#x27;K%&#x27;</span>;</span><br><span class="line"></span><br><span class="line">找出名字中有“_”的：</span><br><span class="line">	<span class="keyword">select</span> name <span class="keyword">from</span> t_student <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;%_%&#x27;</span>; <span class="comment">-- 这样不行</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">select</span> name <span class="keyword">from</span> t_student <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;%\_%&#x27;</span>; <span class="comment">-- \转义字符，右下斜杠</span></span><br></pre></td></tr></table></figure>
<h3 id="3-4排序"><a class="header-anchor" href="#3-4排序">¶</a>3.4排序</h3>
<p><strong>order by</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询所有员工薪资并排序：</span></span><br><span class="line"><span class="keyword">select</span>  ename,sal <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> sal; <span class="operator">/</span><span class="operator">/</span> 默认是升序！！！</span><br></pre></td></tr></table></figure>
<p>指定降序：<strong>desc</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  ename,sal <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> sal <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>
<p>指定升序：<strong>asc</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询员工名字和薪资，要求按照薪资升序，如果薪资一样的话，再按照名字升序排列。</span></span><br><span class="line">	<span class="keyword">select</span> </span><br><span class="line">		ename,sal</span><br><span class="line">	<span class="keyword">from</span></span><br><span class="line">		emp</span><br><span class="line">	<span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">		sal <span class="keyword">asc</span>, ename <span class="keyword">asc</span>; <span class="comment">-- sal在前，起主导，只有sal相等的时候，才会考虑启用ename排序。</span></span><br></pre></td></tr></table></figure>
<p>了解：<strong>根据字段的位置</strong>也可以进行排序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,sal <span class="keyword">from</span> emp <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">2</span>; <span class="comment">-- 这里的2表示第二列，在bjpowernode表中指sal</span></span><br></pre></td></tr></table></figure>
<p>不建议在开发中这样使用，<strong>不健壮</strong>，列的顺序可能会被修改。</p>
<p>综合使用：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询员工薪资在1250到3000并按照薪资降序排列：</span></span><br><span class="line"> <span class="keyword">select</span> </span><br><span class="line">    ename,sal</span><br><span class="line"> <span class="keyword">from</span> </span><br><span class="line">    emp</span><br><span class="line"> <span class="keyword">where</span> </span><br><span class="line">    sal <span class="keyword">between</span> <span class="number">1250</span> <span class="keyword">and</span> <span class="number">3000</span></span><br><span class="line"> <span class="keyword">order</span> <span class="keyword">by</span> </span><br><span class="line">    sal <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>
<h3 id="3-5去重distinct"><a class="header-anchor" href="#3-5去重distinct">¶</a>3.5去重distinct</h3>
<p>将查询结果去重，但原表的数据不会被改变。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 将部门的工作进行去重：</span></span><br><span class="line">       <span class="keyword">select</span> <span class="keyword">distinct</span> job <span class="keyword">from</span> emp;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 注意：distinct关键字只能出现在字段的最前面</span></span><br><span class="line"><span class="comment">-- 例如将部门工作和部门编号进行联合去重：</span></span><br><span class="line">       <span class="keyword">select</span> <span class="keyword">distinct</span> job,deptno <span class="keyword">from</span> emp;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 允许使用分组函数，例如统计工作岗位的数量：</span></span><br><span class="line">       <span class="keyword">select</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> job) <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>
<h3 id="3-6分页"><a class="header-anchor" href="#3-6分页">¶</a>3.6分页</h3>
<p><strong>limit</strong>的作用：将查询<strong>结果集</strong>的一部分取出来。通常使用在分页查询中。</p>
<p>完整用法：limit startIndex, length		startIndex是<strong>起始下标</strong>，length是<strong>取出内容的长度</strong>。起始<strong>下标从0开始</strong>。</p>
<p>默认用法：limit 5; 这是取前5.</p>
<p><strong>按照薪资降序，取出工资排名在前5名的员工</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">select</span> </span><br><span class="line">		ename,sal</span><br><span class="line">	<span class="keyword">from</span></span><br><span class="line">		emp</span><br><span class="line">	<span class="keyword">order</span> <span class="keyword">by</span> </span><br><span class="line">		sal <span class="keyword">desc</span></span><br><span class="line">	limit <span class="number">5</span>; <span class="comment">-- 取前5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 在mysql中limit在order by之后执行！！！！！！</span></span><br></pre></td></tr></table></figure>
<p><strong>取出工资排名在[3-5]名的员工：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">	<span class="keyword">select</span> </span><br><span class="line">		ename,sal</span><br><span class="line">	<span class="keyword">from</span></span><br><span class="line">		emp</span><br><span class="line">	<span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">		sal <span class="keyword">desc</span></span><br><span class="line">	limit</span><br><span class="line">		<span class="number">2</span>, <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 0,1,2,3,4</span></span><br><span class="line"><span class="comment">-- 2表示起始位置从下标2开始，就是第三条记录。</span></span><br><span class="line"><span class="comment">-- 3表示取出内容的长度。</span></span><br></pre></td></tr></table></figure>
<p>每页显示3条记录：</p>
<p>第1页：limit 0,3		[0 1 2]</p>
<p>第2页：limit 3,3		[3 4 5]</p>
<p>第3页：limit 6,3		[6 7 8]</p>
<p>每页显示pageSize条记录</p>
<p>第pageNo页：limit (pageNo - 1) * pageSize  , pageSize</p>
<h2 id="4-函数"><a class="header-anchor" href="#4-函数">¶</a>4.函数</h2>
<h3 id="4-1单行处理函数"><a class="header-anchor" href="#4-1单行处理函数">¶</a>4.1单行处理函数</h3>
<p>单行处理函数的特点：<strong>一个输入对应一个输出。</strong></p>
<p>和单行处理函数相对的是：多行处理函数。（特点：<strong>多个输入对应一个输出。</strong>）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- lower 转换为小写：</span></span><br><span class="line">	<span class="keyword">select</span> <span class="built_in">lower</span>(ename) <span class="keyword">as</span> ename <span class="keyword">from</span> emp; <span class="comment">-- as---&gt;起别名</span></span><br><span class="line"><span class="comment">-- upper 转换为大写：</span></span><br><span class="line">	<span class="keyword">select</span> <span class="built_in">upper</span>(ename) <span class="keyword">as</span> ename <span class="keyword">from</span> emp;</span><br><span class="line"><span class="comment">-- substr 取子串 substr(被截取的字符串, 起始下标从1开始,截取的长度):</span></span><br><span class="line">	<span class="keyword">select</span> substr(ename, <span class="number">1</span>, <span class="number">2</span>) <span class="keyword">as</span> ename <span class="keyword">from</span> emp;</span><br><span class="line"><span class="comment">-- 注意：起始下标从1开始，没有0。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 找出名字中第一个字母是A的员工:</span></span><br><span class="line">			第一种方式：模糊查询</span><br><span class="line">				<span class="keyword">select</span> ename <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="keyword">like</span> <span class="string">&#x27;A%&#x27;</span>; <span class="comment">-- 使用like</span></span><br><span class="line">			第二种方式：substr函数</span><br><span class="line">				<span class="keyword">select</span> </span><br><span class="line">					ename </span><br><span class="line">				<span class="keyword">from</span> </span><br><span class="line">					emp </span><br><span class="line">				<span class="keyword">where</span> </span><br><span class="line">					substr(ename,<span class="number">1</span>,<span class="number">1</span>) <span class="operator">=</span> <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line"><span class="comment">-- concat函数进行字符串的拼接：</span></span><br><span class="line">	<span class="keyword">select</span> concat(empno,ename) <span class="keyword">from</span> emp;<span class="operator">/</span><span class="operator">/</span>将员工编号和员工姓名拼接</span><br><span class="line"><span class="comment">-- length 取长度:</span></span><br><span class="line">	<span class="keyword">select</span> length(ename) <span class="keyword">as</span> ename_length <span class="keyword">from</span> emp;</span><br><span class="line"><span class="comment">-- trim 去空格:</span></span><br><span class="line">	<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="operator">=</span> <span class="string">&#x27;  KING&#x27;</span>; <span class="comment">-- 字符串中有空格，查不到</span></span><br><span class="line">	<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="operator">=</span><span class="built_in">trim</span>(<span class="string">&#x27;  KING&#x27;</span>); <span class="comment">-- 使用trim函数，自动去掉空格</span></span><br><span class="line"><span class="comment">-- str_to_date 将字符串转换成日期</span></span><br><span class="line"><span class="comment">-- date_format 格式化日期</span></span><br><span class="line"><span class="comment">-- format 设置千分位</span></span><br><span class="line"><span class="comment">-- round 四舍五入：</span></span><br><span class="line">		<span class="keyword">select</span> 字段 <span class="keyword">from</span> 表名;</span><br><span class="line">		<span class="keyword">select</span> ename <span class="keyword">from</span> emp;</span><br><span class="line">		<span class="keyword">select</span> <span class="string">&#x27;abc&#x27;</span> <span class="keyword">from</span> emp; <span class="comment">-- select后面直接跟“字面量/字面值”，会将所有行都变成该值</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">select</span> round(<span class="number">1236.567</span>, <span class="number">1</span>) <span class="keyword">as</span> <span class="keyword">result</span> <span class="keyword">from</span> emp; <span class="comment">-- 保留1个小数</span></span><br><span class="line">		<span class="keyword">select</span> round(<span class="number">1236.567</span>, <span class="number">2</span>) <span class="keyword">as</span> <span class="keyword">result</span> <span class="keyword">from</span> emp; <span class="comment">-- 保留2个小数</span></span><br><span class="line">		<span class="keyword">select</span> round(<span class="number">1236.567</span>, <span class="number">0</span>) <span class="keyword">as</span> <span class="keyword">result</span> <span class="keyword">from</span> emp; <span class="comment">-- 保留到整数</span></span><br><span class="line">		<span class="keyword">select</span> round(<span class="number">1236.567</span>, <span class="number">-1</span>) <span class="keyword">as</span> <span class="keyword">result</span> <span class="keyword">from</span> emp; <span class="comment">-- 保留到十位</span></span><br><span class="line"><span class="comment">-- rand() 生成随机数：</span></span><br><span class="line">		<span class="keyword">select</span> round(rand()<span class="operator">*</span><span class="number">100</span>,<span class="number">0</span>) <span class="keyword">from</span> emp; <span class="operator">/</span><span class="operator">/</span> <span class="number">100</span>以内的随机数</span><br><span class="line"><span class="comment">-- ifnull 可以将 null 转换成一个具体值：</span></span><br><span class="line">		<span class="comment">-- ifnull是空处理函数。专门处理空的。</span></span><br><span class="line">		<span class="comment">-- 注意：在所有数据库当中，只要有NULL参与的数学运算，最终结果就是NULL</span></span><br><span class="line">		<span class="comment">--       NULL和另一个值的比较运算的结果为UNKNOWN</span></span><br><span class="line">		<span class="comment">--       在查询语句中，只有使where子句和having短语中的条件为true的元组才会被选中作为输出结果</span></span><br><span class="line">		<span class="keyword">select</span> ename, sal <span class="operator">+</span> comm <span class="keyword">as</span> salcomm <span class="keyword">from</span> emp; <span class="comment">-- comm是补助，部分员工补助为null，和薪资相加还会显示为null</span></span><br><span class="line">		</span><br><span class="line">		<span class="keyword">select</span> ename, (sal <span class="operator">+</span> ifnull(comm,<span class="number">0</span>))<span class="operator">*</span><span class="number">12</span> <span class="keyword">as</span> salcomm <span class="keyword">from</span> emp; <span class="comment">-- 算年薪，判断comm是否为null，若是转化为0</span></span><br><span class="line"></span><br><span class="line">case...when...then...when...then...else...end; 多层命令</span><br><span class="line"><span class="comment">-- 当员工的工作岗位为MANAGER时，薪资上涨10%，为SALESMAN时，薪资上涨50%，其他员工正常：</span></span><br><span class="line">        <span class="keyword">select</span></span><br><span class="line">           ename,</span><br><span class="line">           job,</span><br><span class="line">           sal <span class="keyword">as</span> oldsal,</span><br><span class="line">           (<span class="keyword">case</span> job <span class="keyword">when</span> <span class="string">&#x27;MANAGER&#x27;</span> <span class="keyword">then</span> sal<span class="operator">*</span><span class="number">1.1</span> <span class="keyword">when</span> <span class="string">&#x27;SALESMAN&#x27;</span> <span class="keyword">then</span> sal<span class="operator">*</span><span class="number">1.5</span> <span class="keyword">else</span> sal <span class="keyword">end</span>) <span class="keyword">as</span> newsal</span><br><span class="line">         <span class="keyword">from</span></span><br><span class="line">           emp;</span><br></pre></td></tr></table></figure>
<h3 id="4-2分组函数"><a class="header-anchor" href="#4-2分组函数">¶</a>4.2分组函数</h3>
<p>多行处理函数的特点：输入多行，最终输出一行。</p>
<p><strong>count</strong>   计数</p>
<p><strong>sum</strong>   求和</p>
<p><strong>avg</strong>   平均值</p>
<p><strong>max</strong>   最大值</p>
<p><strong>min</strong>   最小值</p>
<p>注意：分组函数在使用的时候必须先进行分组，然后才能使用。<strong>如果没有对数据进行分组，整张表将默认为一组</strong>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 找出最高工资：</span></span><br><span class="line">		<span class="keyword">select</span> <span class="built_in">max</span>(sal) <span class="keyword">from</span> emp;</span><br><span class="line"><span class="comment">-- 找出最低工资：</span></span><br><span class="line">		<span class="keyword">select</span> <span class="built_in">min</span>(sal) <span class="keyword">from</span> emp;</span><br><span class="line"><span class="comment">-- 计算工资和：</span></span><br><span class="line">		<span class="keyword">select</span> <span class="built_in">sum</span>(sal) <span class="keyword">from</span> emp;</span><br><span class="line"><span class="comment">-- 计算平均工资：</span></span><br><span class="line">		<span class="keyword">select</span> <span class="built_in">avg</span>(sal) <span class="keyword">from</span> emp;</span><br><span class="line"><span class="comment">-- 计算员工数量：</span></span><br><span class="line">		<span class="keyword">select</span> <span class="built_in">count</span>(ename) <span class="keyword">from</span> emp;</span><br></pre></td></tr></table></figure>
<p><strong>需要注意的问题</strong>：</p>
<p>第一点：分组函数<strong>自动忽略NULL</strong>，你不需要提前对NULL进行处理。</p>
<p>第二点：分组函数中count(<code>*</code>)和count(具体字段)有什么区别？</p>
<p><strong>count(具体字段)</strong>：表示统计<strong>该字段下</strong>所有<strong>不为NULL的元素的总数。</strong></p>
<p><strong>count(*)</strong>：统计表中<strong>所有字段的总行数</strong>。（只要有一行数据count则++）</p>
<p>因为<strong>任意一行记录都不可能全为NULL</strong>，一行数据中有一列不为NULL，那么这行数据就是有效的。</p>
<p>第三点：分组函数<strong>不能够直接使用在where子句中</strong>。</p>
<h3 id="4-3group-by"><a class="header-anchor" href="#4-3group-by">¶</a>4.3group by</h3>
<p><strong>找出每个工作岗位的工资和</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 实现思路：先按照工作岗位分组，然后对每个组的工资求和。</span></span><br><span class="line">		<span class="keyword">select</span> </span><br><span class="line">			job,<span class="built_in">sum</span>(sal)</span><br><span class="line">		<span class="keyword">from</span></span><br><span class="line">		    emp</span><br><span class="line">		<span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">			job;</span><br><span class="line"><span class="comment">-- 执行顺序：</span></span><br><span class="line"><span class="comment">-- 先从emp表中查询数据。根据job字段进行分组。然后对每一组的数据进行sum(sal)</span></span><br></pre></td></tr></table></figure>
<p>在一条select语句当中，如果有group by语句的话，select后面只能跟：<strong>参加分组的字段</strong>，以及<strong>分组函数</strong>。其它的一律不能跟。</p>
<p><strong>找出每个部门的最高薪资</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 实现思路：先按照部门编号分组，然后求每一组工资的最大值。</span></span><br><span class="line">	    <span class="keyword">select</span> </span><br><span class="line">	        deptno,<span class="built_in">max</span>(sal) </span><br><span class="line">	    <span class="keyword">from</span> </span><br><span class="line">	        emp </span><br><span class="line">	    <span class="keyword">group</span> <span class="keyword">by</span> </span><br><span class="line">	        deptno;</span><br></pre></td></tr></table></figure>
<h3 id="4-4联合分组"><a class="header-anchor" href="#4-4联合分组">¶</a>4.4联合分组</h3>
<p><strong>找出“每个部门，不同工作岗位”的最高薪资</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 技巧：把两个字段联合成1个字段看。（两个字段联合分组）</span></span><br><span class="line">		<span class="keyword">select</span> </span><br><span class="line">			deptno, job, <span class="built_in">max</span>(sal)</span><br><span class="line">		<span class="keyword">from</span></span><br><span class="line">			emp</span><br><span class="line">		<span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">			deptno, job</span><br><span class="line">		<span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">		    deptno <span class="keyword">asc</span>; <span class="comment">-- 按照部门编号升序排列</span></span><br></pre></td></tr></table></figure>
<h3 id="4-5having"><a class="header-anchor" href="#4-5having">¶</a>4.5having</h3>
<p>使用having可以对分完组之后的数据<strong>进一步过滤</strong>。</p>
<p>having不能单独使用，having不能代替where，having必须和group by<strong>联合使用</strong>。</p>
<p><strong>找出最高薪资大于3000的部门</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">    deptno,<span class="built_in">max</span>(sal) </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">    emp </span><br><span class="line"><span class="keyword">where</span> </span><br><span class="line">    sal <span class="operator">&gt;</span> <span class="number">3000</span> <span class="comment">-- where子句中可以使用字段，但不可使用分组函数</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> </span><br><span class="line">    deptno;</span><br></pre></td></tr></table></figure>
<p><strong>找出平均薪资高于2500的部门</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">    deptno,<span class="built_in">avg</span>(sal) </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">    emp </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> </span><br><span class="line">    deptno</span><br><span class="line"><span class="keyword">having</span></span><br><span class="line">    <span class="built_in">avg</span>(sal) <span class="operator">&gt;</span> <span class="number">2500</span>; <span class="comment">-- 本例中就不可以使用where，因为where子句中无法使用分组函数avg()</span></span><br></pre></td></tr></table></figure>
<p>where和having，优先选择where，where实在完成不了，再选择having。</p>
<h3 id="4-6总结sql执行顺序"><a class="header-anchor" href="#4-6总结sql执行顺序">¶</a>4.6总结sql执行顺序</h3>
<p>语法顺序：select  --&gt; from --&gt; where --&gt; group by --&gt; having --&gt; order by</p>
<p>执行顺序：from --&gt; where --&gt; group by --&gt; having --&gt; select --&gt; order by</p>
<ol>
<li>从某张表中查询数据。</li>
<li>先经过where条件筛选出有价值的数据。</li>
<li>对这些有价值的数据进行分组。</li>
<li>分组之后可以使用having继续筛选。</li>
<li>select查询出来。</li>
<li>最后进行排序。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 找出每个岗位的平均薪资，要求显示平均薪资大于1500的，除MANAGER岗位之外，</span></span><br><span class="line"><span class="comment">-- 要求按照平均薪资降序排：</span></span><br><span class="line">	<span class="keyword">select</span> </span><br><span class="line">		job, <span class="built_in">avg</span>(sal) <span class="keyword">as</span> avgsal</span><br><span class="line">	<span class="keyword">from</span></span><br><span class="line">		emp</span><br><span class="line">	<span class="keyword">where</span></span><br><span class="line">		job <span class="operator">&lt;&gt;</span> <span class="string">&#x27;MANAGER&#x27;</span></span><br><span class="line">	<span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">		job</span><br><span class="line">	<span class="keyword">having</span></span><br><span class="line">		<span class="built_in">avg</span>(sal) <span class="operator">&gt;</span> <span class="number">1500</span></span><br><span class="line">	<span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">		avgsal <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>
<h2 id="5-连接查询"><a class="header-anchor" href="#5-连接查询">¶</a>5.连接查询</h2>
<p>从一张表中单独查询，称为<strong>单表查询</strong>。</p>
<p>将emp表和dept表联合起来查询数据，从emp表中取员工名字，从dept表中取部门名字。<strong>两张表都有相同字段</strong>deptno部门编号。</p>
<p>这种跨表查询，多张表联合起来查询数据，被称为<strong>连接查询</strong>。</p>
<p>当两张表进行连接查询，<strong>没有任何条件限制</strong>的时候，最终查询结果条数，是两张表条数的乘积，这种现象被称为：<strong>笛卡尔积现象</strong>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">    ename,dname </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">    emp, dept; <span class="comment">-- 两张表的每行数据将进行对乘。</span></span><br></pre></td></tr></table></figure>
<h3 id="5-1内连接之等值连接"><a class="header-anchor" href="#5-1内连接之等值连接">¶</a>5.1内连接之等值连接</h3>
<p><strong>查询每个员工所在部门名称，显示员工名和部门名</strong>：</p>
<p>将emp e表和dept d表进行连接。条件是：e.deptno = d.deptno  （部门编号相同）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQL92语法：</span></span><br><span class="line">	<span class="keyword">select</span> </span><br><span class="line">		e.ename,d.dname</span><br><span class="line">	<span class="keyword">from</span></span><br><span class="line">		emp e, dept d   <span class="comment">-- 使用空格起别名</span></span><br><span class="line">	<span class="keyword">where</span></span><br><span class="line">		e.deptno <span class="operator">=</span> d.deptno;</span><br><span class="line">	</span><br><span class="line"><span class="comment">-- sql92的缺点：结构不清晰，表的连接条件和后期进一步筛选的条件，都放到了where后面。</span></span><br><span class="line">	</span><br><span class="line"><span class="comment">-- SQL99语法：</span></span><br><span class="line">	<span class="keyword">select</span> </span><br><span class="line">		e.ename,d.dname</span><br><span class="line">	<span class="keyword">from</span></span><br><span class="line">		emp e</span><br><span class="line">	<span class="keyword">inner</span> <span class="keyword">join</span>   <span class="comment">-- inner可以省略（带着inner可读性更好！！！一眼就能看出来是内连接）</span></span><br><span class="line">		dept d</span><br><span class="line">	<span class="keyword">on</span></span><br><span class="line">		e.deptno <span class="operator">=</span> d.deptno; <span class="comment">-- 条件是等量关系，所以被称为等值连接。</span></span><br><span class="line"><span class="comment">-- sql99优点：表连接的条件是独立的，连接之后，如果还需要进一步筛选，可以往后继续添加where。</span></span><br></pre></td></tr></table></figure>
<h3 id="5-2内连接之非等值连接"><a class="header-anchor" href="#5-2内连接之非等值连接">¶</a>5.2内连接之非等值连接</h3>
<p><strong>找出每个员工的薪资等级，要求显示员工名、薪资、薪资等级</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">	e.ename, e.sal, s.grade</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">	emp e</span><br><span class="line"><span class="keyword">join</span></span><br><span class="line">	salgrade s</span><br><span class="line"><span class="keyword">on</span></span><br><span class="line">	e.sal <span class="keyword">between</span> s.losal <span class="keyword">and</span> s.hisal; <span class="comment">-- 条件不是等量关系，称为非等值连接。</span></span><br></pre></td></tr></table></figure>
<h3 id="5-3内连接之自连接"><a class="header-anchor" href="#5-3内连接之自连接">¶</a>5.3内连接之自连接</h3>
<p><strong>查询所有员工的上级领导，要求显示员工名和对应的领导名</strong>:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 技巧：一张表看成两张表。</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">	a.ename <span class="keyword">as</span> <span class="string">&#x27;员工名&#x27;</span>, b.ename <span class="keyword">as</span> <span class="string">&#x27;领导名&#x27;</span></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">	emp a</span><br><span class="line"><span class="keyword">join</span></span><br><span class="line">	emp b</span><br><span class="line"><span class="keyword">on</span></span><br><span class="line">	a.mgr <span class="operator">=</span> b.empno; <span class="comment">-- 员工的领导编号 = 领导的员工编号</span></span><br></pre></td></tr></table></figure>
<p>缺点：公司中最高领导KING没有上级，内连接无法显示NULL，需要使用外连接。</p>
<h3 id="5-4外连接"><a class="header-anchor" href="#5-4外连接">¶</a>5.4外连接</h3>
<p>内连接：（A和B连接，AB两张表<strong>没有主次关系是平等的</strong>）</p>
<p>内连接的特点：将能够匹配上ON后面的条件的数据查询出来。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- outer是可以省略的，带着可读性强。</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">	e.ename,d.dname</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">	emp e </span><br><span class="line"><span class="keyword">right</span> <span class="keyword">outer</span> <span class="keyword">join</span> </span><br><span class="line">	dept d</span><br><span class="line"><span class="keyword">on</span></span><br><span class="line">	e.deptno <span class="operator">=</span> d.deptno;</span><br></pre></td></tr></table></figure>
<p>right的含义：表示将join关键字右边的这张表<strong>看成主表</strong>，能够<strong>将这张表的数据全部查询出来</strong>，捎带着关联查询左边的表。</p>
<p>在外连接中，两张表连接时<strong>产生了主次关系</strong>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">	e.ename,d.dname</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">	dept d </span><br><span class="line"><span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> <span class="comment">-- 将join左边的表看成主表</span></span><br><span class="line">	emp e</span><br><span class="line"><span class="keyword">on</span></span><br><span class="line">	e.deptno <span class="operator">=</span> d.deptno;</span><br></pre></td></tr></table></figure>
<p>带有right的是右外连接，又叫做<strong>右连接</strong>。</p>
<p>带有left的是左外连接，又叫做<strong>左连接</strong>。</p>
<p>任何一个右连接都有左连接的写法，， 任何一个左连接都有右连接的写法。</p>
<p><strong>案例：查询所有员工的上级领导，要求显示员工名和对应的领导名</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">	a.ename <span class="keyword">as</span> <span class="string">&#x27;员工名&#x27;</span>, b.ename <span class="keyword">as</span> <span class="string">&#x27;领导名&#x27;</span></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">	emp a</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> <span class="comment">-- 将join左边的员工表看成主表，把所有员工都查出来，即使KING的上级为NULL</span></span><br><span class="line">	emp b</span><br><span class="line"><span class="keyword">on</span></span><br><span class="line">	a.mgr <span class="operator">=</span> b.empno; <span class="comment">-- 员工的领导编号 = 领导的员工编号</span></span><br></pre></td></tr></table></figure>
<p>使用外连接可以显示公司最高领导KING的上级为NULL。</p>
<h3 id="5-5多表连接"><a class="header-anchor" href="#5-5多表连接">¶</a>5.5多表连接</h3>
<p><strong>三张表，四张表怎么连接？</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 语法：</span></span><br><span class="line">	<span class="keyword">select</span> </span><br><span class="line">		...</span><br><span class="line">	<span class="keyword">from</span></span><br><span class="line">		a</span><br><span class="line">	<span class="keyword">join</span></span><br><span class="line">		b</span><br><span class="line">	<span class="keyword">on</span></span><br><span class="line">		a和b的连接条件</span><br><span class="line">	<span class="keyword">join</span></span><br><span class="line">		c</span><br><span class="line">	<span class="keyword">on</span></span><br><span class="line">		a和c的连接条件</span><br><span class="line">     <span class="keyword">join</span></span><br><span class="line">		d</span><br><span class="line">	<span class="keyword">on</span></span><br><span class="line">		a和d的连接条件</span><br></pre></td></tr></table></figure>
<p><strong>找出每个员工的部门名称以及工资等级，要求显示员工名、部门名、薪资、薪资等级</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">	e.ename,e.sal,d.dname,s.grade</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">	emp e</span><br><span class="line"><span class="keyword">join</span></span><br><span class="line">	dept d</span><br><span class="line"><span class="keyword">on</span> </span><br><span class="line">	e.deptno <span class="operator">=</span> d.deptno</span><br><span class="line"><span class="keyword">join</span></span><br><span class="line">	salgrade s</span><br><span class="line"><span class="keyword">on</span></span><br><span class="line">	e.sal <span class="keyword">between</span> s.losal <span class="keyword">and</span> s.hisal;</span><br></pre></td></tr></table></figure>
<p><strong>找出每个员工的部门名称以及工资等级，还有上级领导，要求显示员工名、领导名、部门名、薪资、薪资等级</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">	e.ename,e.sal,d.dname,s.grade,l.ename</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">	emp e</span><br><span class="line"><span class="keyword">join</span></span><br><span class="line">	dept d</span><br><span class="line"><span class="keyword">on</span> </span><br><span class="line">	e.deptno <span class="operator">=</span> d.deptno</span><br><span class="line"><span class="keyword">join</span></span><br><span class="line">	salgrade s</span><br><span class="line"><span class="keyword">on</span></span><br><span class="line">	e.sal <span class="keyword">between</span> s.losal <span class="keyword">and</span> s.hisal</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> <span class="comment">-- 左外连接，为了显示KING的上级NULL</span></span><br><span class="line">	emp l</span><br><span class="line"><span class="keyword">on</span></span><br><span class="line">	e.mgr <span class="operator">=</span> l.empno;</span><br></pre></td></tr></table></figure>
<h2 id="6-子查询"><a class="header-anchor" href="#6-子查询">¶</a>6.子查询</h2>
<p>select语句中<strong>嵌套</strong>select语句，被嵌套的select语句称为子查询。</p>
<p>子查询可以出现在 select后面，from 后面，where 后面。</p>
<h3 id="6-1where子句中的子查询"><a class="header-anchor" href="#6-1where子句中的子查询">¶</a>6.1where子句中的子查询</h3>
<p><strong>找出比最低工资高的员工姓名和工资</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">   ename,sal </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">   emp </span><br><span class="line"><span class="keyword">where</span> </span><br><span class="line">   sal <span class="operator">&gt;</span> (<span class="keyword">select</span> <span class="built_in">min</span>(sal) <span class="keyword">from</span> emp);</span><br></pre></td></tr></table></figure>
<h3 id="6-2from子句中的子查询"><a class="header-anchor" href="#6-2from子句中的子查询">¶</a>6.2from子句中的子查询</h3>
<p>from后面的子查询，可以将子查询的查询结果当做一张临时表。（技巧）</p>
<p><strong>找出每个岗位的平均工资的薪资等级</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">	t.<span class="operator">*</span>, s.grade <span class="comment">-- 查询t表的全部字段和s表的grade字段</span></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">    (<span class="keyword">select</span> job,<span class="built_in">avg</span>(sal) <span class="keyword">as</span> avgsal <span class="keyword">from</span> emp <span class="keyword">group</span> <span class="keyword">by</span> job) t <span class="comment">-- 将括号中的sql查询结果看作是t表</span></span><br><span class="line"><span class="keyword">join</span></span><br><span class="line">	salgrade s</span><br><span class="line"><span class="keyword">on</span></span><br><span class="line">	t.avgsal <span class="keyword">between</span> s.losal <span class="keyword">and</span> s.hisal; <span class="comment">-- t表和s表的连接条件 </span></span><br></pre></td></tr></table></figure>
<h3 id="6-3带有exists谓词的子查询"><a class="header-anchor" href="#6-3带有exists谓词的子查询">¶</a>6.3带有exists谓词的子查询</h3>
<p>这篇文章讲的就很好：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43987915/article/details/113761623?spm=1001.2014.3001.5506">最明白的 not exists 双层嵌套讲解 SQL 查询语句_not exist 嵌套-CSDN博客</a></p>
<h2 id="7-union的用法"><a class="header-anchor" href="#7-union的用法">¶</a>7.union的用法</h2>
<p>union的作用是：<strong>合并</strong>查询结果集，完成<strong>拼接</strong>。</p>
<p><strong>查询工作岗位是MANAGER和SALESMAN的员工</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> ename,job <span class="keyword">from</span> emp <span class="keyword">where</span> job <span class="operator">=</span> <span class="string">&#x27;MANAGER&#x27;</span> <span class="comment">-- 第一个sql语句没有分号</span></span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> ename,job <span class="keyword">from</span> emp <span class="keyword">where</span> job <span class="operator">=</span> <span class="string">&#x27;SALESMAN&#x27;</span>; <span class="comment">-- 最后一个sql语句有分号</span></span><br></pre></td></tr></table></figure>
<p><img src="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-06-04_10-35-19.png" alt=""></p>
<p>优点：对于表连接，每连接一次新表，都要进行笛卡尔积匹配，而且匹配次数会成倍的翻。</p>
<p><strong>union可以减少匹配次数，效率更高。</strong></p>
<p>例如：a表 连接 b表 连接 c表</p>
<p>a表-10条记录   b表-10条记录   c表-10条记录</p>
<p>表连接的匹配次数：10<code>*</code>10<code>*</code>10=1000次</p>
<p>union的匹配次数：a表连接b表—&gt;10<code>*</code>10=100次   a表连接c表—&gt;10<code>*</code>10=100次</p>
<p>​                                 100+100=200次</p>
<p><strong>使用union时的注意事项</strong>：</p>
<p>合并查询结果集时，两个结果集的字段列数要相同，此外，字段的数据类型也要一致（mysql中不报错，oracle中会报错）。</p>
<p>使用union将多个查询结果合并起来时，<strong>系统会自动去掉重复元组</strong>。如果要保留重复元组，可使用<code>union all</code>。</p>
<p><strong>注</strong>：除了<strong>union</strong>(求并集[或])，还有<strong>intersect</strong>(求交集[且])，以及<strong>except</strong>(求差集[A-B])。</p>
<h2 id="8-约束"><a class="header-anchor" href="#8-约束">¶</a>8.约束</h2>
<p>在创建表的时候，可以给表中的字段加上一些约束，来保证表中数据的完整性、有效性。</p>
<h3 id="8-1约束类型"><a class="header-anchor" href="#8-1约束类型">¶</a>8.1约束类型</h3>
<p>非空约束：not null</p>
<p>唯一性约束: unique</p>
<p>主键约束: primary key （简称PK）</p>
<p>外键约束：foreign key（简称FK）</p>
<p>检查约束：<strong>check</strong>（mysql不支持，oracle支持）</p>
<p>我们这里重点学习四个约束：<strong>not null，unique，primary key，foreign key</strong>。</p>
<h3 id="8-2not-null"><a class="header-anchor" href="#8-2not-null">¶</a>8.2not null</h3>
<p>非空约束not null约束的字段不能为NULL。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> t_vip;</span><br><span class="line">	<span class="keyword">create</span> <span class="keyword">table</span> t_vip(</span><br><span class="line">		id <span class="type">int</span>,</span><br><span class="line">		name <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="comment">-- not null只有列级约束，没有表级约束</span></span><br><span class="line">	);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_vip(id,name) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;zhangsan&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_vip(id) <span class="keyword">values</span>(<span class="number">3</span>); <span class="comment">-- 只插入id，不插入name，name字段不被默认为NULL</span></span><br><span class="line">	<span class="comment">-- 报错：ERROR 1364 (HY000): Field &#x27;name&#x27; doesn&#x27;t have a default value</span></span><br></pre></td></tr></table></figure>
<h3 id="8-3unique"><a class="header-anchor" href="#8-3unique">¶</a>8.3unique</h3>
<p>唯一性约束unique约束的<strong>字段不能重复</strong>，但是<strong>可以为NULL</strong>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> t_vip;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_vip(</span><br><span class="line">	id <span class="type">int</span>,</span><br><span class="line">	name <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">unique</span>,</span><br><span class="line">	email <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_vip(id,name,email) <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;lisi&#x27;</span>,<span class="string">&#x27;lisi@123.com&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_vip(id,name,email) <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">&#x27;wangwu&#x27;</span>,<span class="string">&#x27;wangwu@123.com&#x27;</span>); <span class="comment">-- wangwu</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_vip;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_vip(id,name,email) <span class="keyword">values</span>(<span class="number">4</span>,<span class="string">&#x27;wangwu&#x27;</span>,<span class="string">&#x27;wangwu@sina.com&#x27;</span>); <span class="comment">-- 重复的wangwu</span></span><br><span class="line"><span class="comment">-- 报错：ERROR 1062 (23000): Duplicate entry &#x27;wangwu&#x27; for key &#x27;name&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_vip(id) <span class="keyword">values</span>(<span class="number">4</span>); <span class="comment">-- 只插入id，不插入name，name字段被默认为NULL</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_vip(id) <span class="keyword">values</span>(<span class="number">5</span>);</span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------------------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name     <span class="operator">|</span> email            <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------------------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> zhangsan <span class="operator">|</span> zhangsan<span class="variable">@123</span>.com <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> lisi     <span class="operator">|</span> lisi<span class="variable">@123</span>.com     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> wangwu   <span class="operator">|</span> wangwu<span class="variable">@123</span>.com   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> <span class="keyword">NULL</span>     <span class="operator">|</span> <span class="keyword">NULL</span>             <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> <span class="keyword">NULL</span>     <span class="operator">|</span> <span class="keyword">NULL</span>             <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+------------------+</span></span><br><span class="line"><span class="comment">-- name字段虽然被unique约束了，但是可以为NULL</span></span><br></pre></td></tr></table></figure>
<h4 id="8-3-1联合唯一"><a class="header-anchor" href="#8-3-1联合唯一">¶</a>8.3.1联合唯一</h4>
<p>例如name和email两个字段联合起来具有唯一性。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> t_vip;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_vip(</span><br><span class="line">	id <span class="type">int</span>,</span><br><span class="line">	name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">	email <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">	<span class="keyword">unique</span>(name,email) <span class="comment">-- 约束没有添加在列的后面，这种约束被称为表级约束。</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_vip(id,name,email) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;zhangsan&#x27;</span>,<span class="string">&#x27;zhangsan@123.com&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_vip(id,name,email) <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;zhangsan&#x27;</span>,<span class="string">&#x27;zhangsan@sina.com&#x27;</span>);</span><br><span class="line">	<span class="comment">-- name和email两个字段联合起来具有唯一性</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_vip(id,name,email) <span class="keyword">values</span>(<span class="number">3</span>,<span class="string">&#x27;zhangsan&#x27;</span>,<span class="string">&#x27;zhangsan@sina.com&#x27;</span>); <span class="comment">-- 重复插入</span></span><br><span class="line">	<span class="comment">-- 报错：ERROR 1062 (23000): Duplicate entry &#x27;zhangsan-zhangsan@sina.com&#x27; for key &#x27;name&#x27;</span></span><br></pre></td></tr></table></figure>
<p>在mysql当中，如果一个字段<strong>同时被not null和unique约束</strong>的话，该字段自动变成<strong>主键</strong>字段。（注意：在oracle中不一样）</p>
<h3 id="8-4primary-key"><a class="header-anchor" href="#8-4primary-key">¶</a>8.4primary key</h3>
<p>主键值是每一行记录的<strong>唯一</strong>标识。主键值是每一行记录的<code>身份证号</code>。</p>
<p>主键的特征：not null + unique（主键值<strong>不能为NULL</strong>，同时也<strong>不能重复</strong>）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> t_vip;</span><br><span class="line">		<span class="comment">-- 1个字段作为主键，叫做：单一主键</span></span><br><span class="line">		<span class="keyword">create</span> <span class="keyword">table</span> t_vip(</span><br><span class="line">			id <span class="type">int</span> <span class="keyword">primary</span> key,  <span class="comment">-- 列级约束 </span></span><br><span class="line">			name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">            <span class="keyword">primary</span> key(id)  <span class="comment">-- 表级约束</span></span><br><span class="line">		);</span><br><span class="line">		<span class="keyword">insert</span> <span class="keyword">into</span> t_vip(id,name) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;zhangsan&#x27;</span>);</span><br><span class="line">		<span class="keyword">insert</span> <span class="keyword">into</span> t_vip(id,name) <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;lisi&#x27;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">-- 错误：不能重复</span></span><br><span class="line">		<span class="keyword">insert</span> <span class="keyword">into</span> t_vip(id,name) <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;wangwu&#x27;</span>);</span><br><span class="line">		ERROR <span class="number">1062</span> (<span class="number">23000</span>): Duplicate entry <span class="string">&#x27;2&#x27;</span> <span class="keyword">for</span> key <span class="string">&#x27;PRIMARY&#x27;</span> <span class="comment">-- id=2重复</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">-- 错误：不能为NULL</span></span><br><span class="line">		<span class="keyword">insert</span> <span class="keyword">into</span> t_vip(name) <span class="keyword">values</span>(<span class="string">&#x27;zhaoliu&#x27;</span>); <span class="comment">-- id不能为NULL</span></span><br><span class="line">		ERROR <span class="number">1364</span> (HY000): Field <span class="string">&#x27;id&#x27;</span> doesn<span class="string">&#x27;t have a default value</span></span><br></pre></td></tr></table></figure>
<h4 id="8-4-1复合主键"><a class="header-anchor" href="#8-4-1复合主键">¶</a>8.4.1复合主键</h4>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> t_vip;</span><br><span class="line">		<span class="comment">-- id和name联合起来作为主键：复合主键</span></span><br><span class="line">		<span class="keyword">create</span> <span class="keyword">table</span> t_vip(</span><br><span class="line">			id <span class="type">int</span>,</span><br><span class="line">			name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">			email <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">			<span class="keyword">primary</span> key(id,name)</span><br><span class="line">		);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_vip(id,name,email) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;zhangsan&#x27;</span>,<span class="string">&#x27;zhangsan@123.com&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_vip(id,name,email) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;lisi&#x27;</span>,<span class="string">&#x27;lisi@123.com&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 错误：不能重复</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_vip(id,name,email) <span class="keyword">values</span>(<span class="number">1</span>,<span class="string">&#x27;lisi&#x27;</span>,<span class="string">&#x27;lisi@123.com&#x27;</span>);</span><br><span class="line"><span class="comment">-- ERROR 1062 (23000): Duplicate entry &#x27;1-lisi&#x27; for key &#x27;PRIMARY&#x27; -- id=1，name为lisi的数据已经存在</span></span><br></pre></td></tr></table></figure>
<p>在实际开发中不建议使用复合主键，<strong>建议使用单一主键</strong>。</p>
<p>因为主键值存在的意义就是这行记录的身份证号，只要意义达到即可，单一主键可以做到。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 一个表中主键约束能加两个吗？</span></span><br><span class="line">		<span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> t_vip;</span><br><span class="line">		<span class="keyword">create</span> <span class="keyword">table</span> t_vip(</span><br><span class="line">			id <span class="type">int</span> <span class="keyword">primary</span> key,</span><br><span class="line">			name <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">primary</span> key</span><br><span class="line">		);</span><br><span class="line">		ERROR <span class="number">1068</span> (<span class="number">42000</span>): Multiple <span class="keyword">primary</span> key defined <span class="comment">-- 多个主键报错</span></span><br></pre></td></tr></table></figure>
<p>结论：在一张表中，主键约束只能添加1个。（<strong>主键只能有1个</strong>）</p>
<p><strong>主键分类</strong></p>
<p><strong>自然</strong>主键：主键值是一个自然数，和业务没关系。</p>
<p><strong>业务</strong>主键：主键值和业务紧密关联，例如拿银行卡账号做主键值，这就是业务主键。</p>
<h4 id="8-4-2主键自增"><a class="header-anchor" href="#8-4-2主键自增">¶</a>8.4.2主键自增</h4>
<p>在mysql当中，有一种机制，可以帮助我们自动维护一个主键值。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> t_vip;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_vip(</span><br><span class="line">	id <span class="type">int</span> <span class="keyword">primary</span> key auto_increment, <span class="comment">-- auto_increment表示自增，从1开始，以1递增！</span></span><br><span class="line">	name <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br><span class="line">		<span class="keyword">insert</span> <span class="keyword">into</span> t_vip(name) <span class="keyword">values</span>(<span class="string">&#x27;zhangsan&#x27;</span>);</span><br><span class="line">		<span class="keyword">insert</span> <span class="keyword">into</span> t_vip(name) <span class="keyword">values</span>(<span class="string">&#x27;zhangsan&#x27;</span>);</span><br><span class="line">		<span class="keyword">insert</span> <span class="keyword">into</span> t_vip(name) <span class="keyword">values</span>(<span class="string">&#x27;zhangsan&#x27;</span>);</span><br><span class="line">		<span class="keyword">insert</span> <span class="keyword">into</span> t_vip(name) <span class="keyword">values</span>(<span class="string">&#x27;zhangsan&#x27;</span>);</span><br><span class="line">		<span class="keyword">insert</span> <span class="keyword">into</span> t_vip(name) <span class="keyword">values</span>(<span class="string">&#x27;zhangsan&#x27;</span>);</span><br><span class="line">结果：</span><br><span class="line">		<span class="operator">+</span><span class="comment">----+----------+</span></span><br><span class="line">		<span class="operator">|</span> id <span class="operator">|</span> name     <span class="operator">|</span></span><br><span class="line">		<span class="operator">+</span><span class="comment">----+----------+</span></span><br><span class="line">		<span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> zhangsan <span class="operator">|</span></span><br><span class="line">		<span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> zhangsan <span class="operator">|</span></span><br><span class="line">		<span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> zhangsan <span class="operator">|</span></span><br><span class="line">		<span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> zhangsan <span class="operator">|</span></span><br><span class="line">		<span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> zhangsan <span class="operator">|</span></span><br></pre></td></tr></table></figure>
<h3 id="8-5foreign-key"><a class="header-anchor" href="#8-5foreign-key">¶</a>8.5foreign key</h3>
<p>如果一个实体的某个字段指向另一个实体的主键，该字段就叫做<strong>外键</strong>。</p>
<p>被指向的实体，称之为主实体（主表），也叫父实体（父表）。</p>
<p>负责指向的实体，称之为从实体（从表），也叫子实体（子表）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_class( <span class="comment">-- 班级表作为主表</span></span><br><span class="line">	classno <span class="type">int</span> <span class="keyword">primary</span> key, <span class="comment">-- 班号作为主键</span></span><br><span class="line">	classname <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_student( <span class="comment">-- 学生表作为子表</span></span><br><span class="line">	<span class="keyword">no</span> <span class="type">int</span> <span class="keyword">primary</span> key auto_increment, <span class="comment">-- 学号作为主键且自增 </span></span><br><span class="line">	name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">	cno <span class="type">int</span>,</span><br><span class="line">	<span class="keyword">foreign</span> key(cno) <span class="keyword">references</span> t_class(classno) <span class="comment">-- 学生的班号参照班级表的班号（在主表中是主键），这里学生的班号作为外键</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_class(classno, classname) <span class="keyword">values</span>(<span class="number">100</span>, <span class="string">&#x27;北京市大兴区亦庄镇第二中学高三1班&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_class(classno, classname) <span class="keyword">values</span>(<span class="number">101</span>, <span class="string">&#x27;北京市大兴区亦庄镇第二中学高三1班&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_student(name,cno) <span class="keyword">values</span>(<span class="string">&#x27;jack&#x27;</span>, <span class="number">100</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_student(name,cno) <span class="keyword">values</span>(<span class="string">&#x27;lilei&#x27;</span>, <span class="number">100</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_student(name,cno) <span class="keyword">values</span>(<span class="string">&#x27;hanmeimei&#x27;</span>, <span class="number">100</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_student(name,cno) <span class="keyword">values</span>(<span class="string">&#x27;zhangsan&#x27;</span>, <span class="number">101</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_student(name,cno) <span class="keyword">values</span>(<span class="string">&#x27;lisi&#x27;</span>, <span class="number">101</span>);</span><br></pre></td></tr></table></figure>
<p><strong>外键值可以为空</strong>，可以理解为：一名学生必定会关联到一个存在的班级，但是来了一个转校生，他还没有分班，现在属于学生子表，还没有关联到班级主表中的任何一条记录。</p>
<p>t_class是父表，t_student是子表（理解记忆）</p>
<p><strong>删除表</strong>的顺序：先删子，再删父。</p>
<p><strong>创建表</strong>的顺序：先创建父，再创建子。</p>
<p><strong>删除数据</strong>的顺序：先删子，再删父。</p>
<p><strong>插入数据</strong>的顺序：先插入父，再插入子</p>
<p>子表中的外键引用父表中的某个字段，<strong>被引用的这个字段不一定是主表的主键</strong>，但是<strong>要具有unique约束（数据不重复</strong>）。</p>
<h2 id="9-存储引擎"><a class="header-anchor" href="#9-存储引擎">¶</a>9.存储引擎</h2>
<p>存储引擎是MySQL中特有的一个术语，其它数据库中没有。（Oracle中有，但是不叫这个名字）</p>
<p>实际上存储引擎是一个表<strong>存储/组织数据</strong>的方式。</p>
<p>不同的存储引擎，表<strong>存储数据</strong>的方式不同。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> t_student;</span><br><span class="line"><span class="comment">-- 可以在建表的时候给表指定存储引擎。</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `t_student` (</span><br><span class="line">  `<span class="keyword">no</span>` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `cno` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`<span class="keyword">no</span>`),</span><br><span class="line">  KEY `cno` (`cno`),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> `t_student_ibfk_1` <span class="keyword">FOREIGN</span> KEY (`cno`) <span class="keyword">REFERENCES</span> `t_class` (`classno`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">11</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="comment">-- 这里可以查看引擎</span></span><br></pre></td></tr></table></figure>
<p>在建表的时候可以在最后的小括号&quot;)&quot;的右边使用：</p>
<p>ENGINE来<strong>指定存储引擎</strong>。mysql默认的存储引擎是：<strong>InnoDB</strong></p>
<p>CHARSET来<strong>指定</strong>这张表的<strong>字符编码方式</strong>。mysql默认的字符编码方式是：<strong>utf8</strong> (qbk支持中文)</p>
<h3 id="9-1mysql支持的存储引擎"><a class="header-anchor" href="#9-1mysql支持的存储引擎">¶</a>9.1mysql支持的存储引擎</h3>
<p><code>show engines \G </code>  查看mysql支持哪些存储引擎</p>
<p>mysql的版本不同支持存储引擎的情况不同。</p>
<h3 id="9-2MyISAM存储引擎"><a class="header-anchor" href="#9-2MyISAM存储引擎">¶</a>9.2MyISAM存储引擎</h3>
<p>使用三个文件表示每个表：</p>
<ol>
<li>格式文件 — 存储表结构的定义（mytable.frm）</li>
<li>数据文件 — 存储表行的内容（mytable.MYD）</li>
<li>索引文件 — 存储表上索引（mytable.MYI）：索引可以看作是一本书的目录，缩小扫描范围，提高查询效率的一种机制。</li>
</ol>
<p>MyISAM存储引擎特点：</p>
<ol>
<li>可被转换为压缩表、只读表来节省空间。</li>
<li>MyISAM不支持事务机制，安全性较低。</li>
</ol>
<h3 id="9-3InnoDB存储引擎"><a class="header-anchor" href="#9-3InnoDB存储引擎">¶</a>9.3InnoDB存储引擎</h3>
<p>这是mysql默认的存储引擎，是一个<strong>重量级</strong>的存储引擎。</p>
<p>InnoDB<strong>支持事务</strong>，支持数据库崩溃后的自动恢复机制。</p>
<p>InnoDB存储引擎最主要的特点是：<strong>非常安全</strong>。</p>
<p>它管理的表具有下列主要特征：</p>
<ol>
<li>
<p>每个 InnoDB表在数据库目录中以.frm 格式文件表示</p>
</li>
<li>
<p>InnoDB的<strong>表空间tablespace</strong> 用于存储表的内容（表空间是一个逻辑名称。表空间存储数据和索引。）</p>
</li>
<li>
<p>提供一组用来记录事务性活动的日志文件</p>
</li>
<li>
<p>用 COMMIT(提交)、SAVEPOINT 及ROLLBACK(回滚)支持事务处理</p>
</li>
<li>
<p>提供全 ACID 兼容</p>
</li>
<li>
<p>在 MySQL 服务器崩溃后提供自动恢复</p>
</li>
<li>
<p>多版本（MVCC）和行级锁定</p>
</li>
<li>
<p>支持外键及引用的完整性，包括级联删除和更新</p>
<p>InnoDB最大的特点就是支持事务以保证数据的安全。</p>
<p>效率不是很高，并且不能压缩，也不能转换为只读表，不能很好的节省存储空间。</p>
</li>
</ol>
<h3 id="9-4MEMORY存储引擎"><a class="header-anchor" href="#9-4MEMORY存储引擎">¶</a>9.4MEMORY存储引擎</h3>
<p>使用MEMORY存储引擎的表，其<strong>数据存储在内存中</strong>，且行的长度固定，这两个特点使得 MEMORY 存储引擎非常<strong>快</strong>。</p>
<p>MEMORY 存储引擎管理的表具有下列特征：</p>
<ol>
<li>在数据库目录内，每个表均以.frm 格式的文件表示。</li>
<li>表数据及索引被存储在内存中。（目的就是快，查询快）</li>
<li>表级锁机制。</li>
<li>不能包含 TEXT 或 BLOB 字段。</li>
</ol>
<p>MEMORY 存储引擎以前被称为HEAP 引擎。</p>
<p>MEMORY引擎优点：<strong>查询效率是最高的</strong>。不需要和硬盘交互。</p>
<p>MEMORY引擎缺点：<strong>不安全</strong>，关机之后数据消失。因为数据和索引都是在内存当中。</p>
<h2 id="10-事务"><a class="header-anchor" href="#10-事务">¶</a>10.事务</h2>
<p>一个事务其实就是一个完整的业务逻辑。是一个最小的工作单元，不可再分。</p>
<p><strong>什么是一个完整的业务逻辑</strong>：</p>
<p>假设转账，从A账户向B账户中转账10000元。将A账户的钱减去10000元（update语句）<br>
，将B账户的钱加上10000元（update语句）<br>
。</p>
<p>这就是一个完整的业务逻辑。</p>
<p>以上的操作是一个最小的工作单元，要么同时成功，要么同时失败，不可再分。</p>
<p>这两个update语句<strong>要求必须同时成功或者同时失败</strong>，这样才能保证钱的数量是正确的。</p>
<p>insert   delete   update  <strong>只有</strong>这三个命令和事务有关系，其它命令都没有关系。</p>
<p>做某件事的时候需要多条DML语句共同联合起来才能完成，所以才需要事务的存在。</p>
<p>事务：就是<strong>批量的DML语句同时成功，或者同时失败</strong></p>
<h3 id="10-1InnoDB实现事务"><a class="header-anchor" href="#10-1InnoDB实现事务">¶</a>10.1InnoDB实现事务</h3>
<p>InnoDB存储引擎：提供一组用来<strong>记录事务性活动的日志文件</strong></p>
<p>在事务的执行过程中，<strong>每一条DML语句</strong>的操作都会记录到 “事务性活动的日志文件” 中。</p>
<p>在事务的执行过程中，我们可以<strong>提交事务</strong>，也可以<strong>回滚事务</strong>。</p>
<p>提交事务： <strong>commit</strong>;</p>
<ul>
<li>清空事务性活动的日志文件，将数据<strong>全部彻底持久化</strong>到数据库表中。</li>
<li>提交事务标志着，事务的结束。并且是一种<strong>全部成功的结束</strong>。</li>
</ul>
<p>回滚事务：<strong>rollback</strong>;   (永远只能回滚到上一次的提交点）</p>
<ul>
<li>将之前所有的DML操作全部撤销，并且清空事务性活动的日志文件</li>
<li>回滚事务标志着，事务的结束。并且是一种<strong>全部失败的结束</strong>。</li>
</ul>
<p>在mysql中，每执行一条DML语句，系统会自动提交事务，这与实际开发中<strong>多条DML语句联合工作</strong>不符</p>
<p>故要将mysql的自动提交机制<strong>关闭</strong>：start transaction;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 事务回滚</span></span><br><span class="line">	mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dept_bak;</span><br><span class="line">		<span class="keyword">Empty</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line">	mysql<span class="operator">&gt;</span> <span class="keyword">start</span> transaction; <span class="comment">-- 关闭自动提交机制，开启我们自己的事务</span></span><br><span class="line">	Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">	mysql<span class="operator">&gt;</span> <span class="keyword">insert</span> <span class="keyword">into</span> dept_bak <span class="keyword">values</span>(<span class="number">10</span>,<span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;tj&#x27;</span>);</span><br><span class="line">	Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">	mysql<span class="operator">&gt;</span> <span class="keyword">insert</span> <span class="keyword">into</span> dept_bak <span class="keyword">values</span>(<span class="number">10</span>,<span class="string">&#x27;abc&#x27;</span>, <span class="string">&#x27;tj&#x27;</span>);</span><br><span class="line">	Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">	mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dept_bak;</span><br><span class="line">	<span class="operator">+</span><span class="comment">--------+-------+------+</span></span><br><span class="line">	<span class="operator">|</span> DEPTNO <span class="operator">|</span> DNAME <span class="operator">|</span> LOC  <span class="operator">|</span></span><br><span class="line">	<span class="operator">+</span><span class="comment">--------+-------+------+</span></span><br><span class="line">	<span class="operator">|</span>     <span class="number">10</span> <span class="operator">|</span> abc   <span class="operator">|</span> tj   <span class="operator">|</span></span><br><span class="line">	<span class="operator">|</span>     <span class="number">10</span> <span class="operator">|</span> abc   <span class="operator">|</span> tj   <span class="operator">|</span></span><br><span class="line">	<span class="operator">+</span><span class="comment">--------+-------+------+</span></span><br><span class="line">	<span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">	mysql<span class="operator">&gt;</span> <span class="keyword">rollback</span>; <span class="comment">-- 回滚事务</span></span><br><span class="line">	Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">	mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dept_bak;</span><br><span class="line">	<span class="keyword">Empty</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec) <span class="comment">-- 因为一直都没有提交事务，回滚到插入数据之前的节点</span></span><br></pre></td></tr></table></figure>
<h3 id="10-2事务的四个特性"><a class="header-anchor" href="#10-2事务的四个特性">¶</a>10.2事务的四个特性</h3>
<p><strong>A：原子性</strong>   说明事务是最小的工作单元，不可再分。</p>
<p><strong>C：一致性</strong>   所有的事务要求在同一个事务当中，所有的操作必须同时成功，或者同时失败，以保证数据的一致性。</p>
<p><strong>I：隔离性</strong>   A事务和B事务之间具有一定的隔离。</p>
<p>教室A和教室B之间有一道墙，那么这道墙就是隔离性。</p>
<p><strong>D：持久性</strong>   事务<strong>最终结束</strong>的一个保障。事务提交，就相当于将没有保存到硬盘上的数据保存到硬盘上。</p>
<h3 id="10-3事务的隔离性"><a class="header-anchor" href="#10-3事务的隔离性">¶</a>10.3事务的隔离性</h3>
<h4 id="10-3-1事务与事务之间的四个隔离级别"><a class="header-anchor" href="#10-3-1事务与事务之间的四个隔离级别">¶</a>10.3.1事务与事务之间的四个隔离级别</h4>
<p><strong>读未提交：read uncommitted（最低的隔离级别，没有提交就读到了）</strong></p>
<ul>
<li>事务A可以读取到事务B<strong>未提交</strong>的数据。</li>
<li>存在的问题是：<strong>脏读现象</strong>(Dirty Read)，我们称读到了脏数据。</li>
<li>这种隔离级别一般都是理论上的，大多数的数据库隔离级别都是二档起步。</li>
</ul>
<p><strong>读已提交：read committed（提交之后才能读到）</strong></p>
<ul>
<li>
<p>事务A只能读取到事务B<strong>提交之后</strong>的数据。</p>
</li>
<li>
<p>解决了脏读的现象。</p>
</li>
<li>
<p>不可重复读取数据。</p>
<p>例如：在事务开启之后，第一次读到的数据是3条，当前事务还没有结束，可能第二次再读取的时候，读到的数据是4条，3不等于4，称为不可重复读取。</p>
</li>
<li>
<p>这种隔离级别是<strong>比较真实</strong>的数据，每一次读到的数据是绝对的真实。</p>
</li>
<li>
<p>oracle数据库默认的隔离级别是：read committed</p>
</li>
</ul>
<p><strong>可重复读：repeatable read（提交之后也读不到，永远读取的都是刚开启事务时的数据）</strong></p>
<ul>
<li>
<p><strong>事务A开启之后</strong>，不管是多久，每一次在事务A中读取到的数据都是一致的。即使事务B将数据已经修改，并且提交了，事务A读取到的数据还是没有发生改变，这就是可重复读。</p>
</li>
<li>
<p>可重复读可能会出现<strong>幻影读</strong>。每一次读取到的数据都是幻象，不够真实。</p>
<p>例如：早晨9点开始开启了事务，只要事务不结束，到晚上9点，读到的数据还是早晨9点的，读到的是假象。</p>
</li>
<li>
<p>mysql中默认的事务隔离级别：repeatable read</p>
</li>
</ul>
<p><strong>序列化/串行化：serializable（最高的隔离级别）</strong></p>
<ul>
<li>这是最高的隔离级别，效率最低。但是解决了以上的所有问题。</li>
<li>这种隔离级别表示<strong>事务排队</strong>，不能并发！</li>
<li>synchronized，线程同步（事务同步的）每一次读取到的数据都是最真实的，并且效率是最低的。</li>
</ul>
<h4 id="10-3-2验证各种隔离级别"><a class="header-anchor" href="#10-3-2验证各种隔离级别">¶</a>10.3.2验证各种隔离级别</h4>
<p>mysql查看隔离级别：select @@transaction_isolation;</p>
<p><strong>验证：read uncommited</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">set</span> <span class="keyword">global</span> transaction isolation level read uncommitted; <span class="comment">-- 设置全局事务的隔离性为读未提交</span></span><br><span class="line">事务A													事务B</span><br><span class="line"><span class="comment">--------------------------------------------------------------------------------</span></span><br><span class="line">use bjpowernode;                                     use bjpowernode;</span><br><span class="line">													</span><br><span class="line"><span class="keyword">start</span> transaction;                                   <span class="keyword">start</span> transaction; <span class="comment">-- 开启事务  </span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_user; <span class="comment">-- 第一次查表是空</span></span><br><span class="line">													</span><br><span class="line">												<span class="keyword">insert</span> <span class="keyword">into</span> t_user <span class="keyword">values</span>(<span class="string">&#x27;zhangsan&#x27;</span>); <span class="comment">-- 事务B向表中插入数据</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_user; <span class="comment">-- 第二次查表可以看到事务B插入的数据</span></span><br></pre></td></tr></table></figure>
<p><strong>验证：read commited</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">set</span> <span class="keyword">global</span> transaction isolation level read committed; <span class="comment">-- 设置全局事务的隔离性为读已提交</span></span><br><span class="line">事务A													事务B</span><br><span class="line"><span class="comment">--------------------------------------------------------------------------------</span></span><br><span class="line">use bjpowernode;</span><br><span class="line">													use bjpowernode;</span><br><span class="line"><span class="keyword">start</span> transaction;</span><br><span class="line">													<span class="keyword">start</span> transaction;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_user; <span class="comment">-- 空</span></span><br><span class="line">													<span class="keyword">insert</span> <span class="keyword">into</span> t_user <span class="keyword">values</span>(<span class="string">&#x27;zhangsan&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_user; <span class="comment">-- 空</span></span><br><span class="line">													<span class="keyword">commit</span>; <span class="comment">-- 事务B将数据提交</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_user; <span class="comment">-- 事务A才能看到事务B插入的数据</span></span><br></pre></td></tr></table></figure>
<p><strong>验证：repeatable read</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">set</span> <span class="keyword">global</span> transaction isolation level repeatable read;</span><br><span class="line">事务A													事务B</span><br><span class="line"><span class="comment">--------------------------------------------------------------------------------</span></span><br><span class="line">use bjpowernode;</span><br><span class="line">													use bjpowernode;</span><br><span class="line"><span class="keyword">start</span> transaction;</span><br><span class="line">													<span class="keyword">start</span> transaction;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_user; </span><br><span class="line">													<span class="keyword">insert</span> <span class="keyword">into</span> t_user <span class="keyword">values</span>(<span class="string">&#x27;lisi&#x27;</span>);</span><br><span class="line">													<span class="keyword">insert</span> <span class="keyword">into</span> t_user <span class="keyword">values</span>(<span class="string">&#x27;wangwu&#x27;</span>);</span><br><span class="line">													<span class="keyword">commit</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_user; <span class="comment">-- 永远读取的都是刚开启事务时的数据，事务B提交数据之后也读不到</span></span><br></pre></td></tr></table></figure>
<p><strong>验证：serializable</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">set</span> <span class="keyword">global</span> transaction isolation level serializable;</span><br><span class="line">事务A													事务B</span><br><span class="line"><span class="comment">--------------------------------------------------------------------------------</span></span><br><span class="line">use bjpowernode;</span><br><span class="line">													use bjpowernode;</span><br><span class="line"><span class="keyword">start</span> transaction;</span><br><span class="line">													<span class="keyword">start</span> transaction;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_user;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_user <span class="keyword">values</span>(<span class="string">&#x27;abc&#x27;</span>); <span class="comment">-- 直到事务A提交，事务B都无法进行操作                       </span></span><br><span class="line">                                                          <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_user; <span class="comment">-- 操作被隔断，需要等事务A彻底完成                                          </span></span><br></pre></td></tr></table></figure>
<h2 id="11-索引"><a class="header-anchor" href="#11-索引">¶</a>11.索引</h2>
<p>索引<strong>在表的字段上添加</strong>，是<strong>提高查询效率</strong>的一种机制。</p>
<p>一张表的一个字段可以添加一个索引，多个字段联合起来也可以添加索引。</p>
<p>索引相当于一本书的目录，是为了缩小扫描范围而存在的一种机制。</p>
<p>MySQL在查询方面主要就是<strong>两种方式</strong>：全表扫描  ；根据索引检索。</p>
<p>在mysql数据库当中索引也是需要排序的，并且这个所以的排序和<strong>TreeSet数据结构</strong>相同。</p>
<p>TreeSet（TreeMap）底层是一个自平衡的二叉树。在mysql当中索引是一个<strong>B-Tree数据结构</strong>。</p>
<p>遵循<strong>左小右大</strong>的原则存放数据，采用<strong>中序遍历</strong>方式遍历取数据。</p>
<p><strong>索引的实现原理</strong>：</p>
<img src="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-25_11-09-21.png" style="zoom: 50%;" />
<ul>
<li>
<p>Tip1：在任何数据库当中<strong>主键都会自动添加索引对象</strong>，id字段上自动有索引，因为id是主键。</p>
<p>另外在mysql当中，一个字段上如果有<strong>unique约束</strong>的话，也会自动创建索引对象</p>
</li>
<li>
<p>Tip2：在任何数据库当中，任何一张表的任何一条记录在硬盘存储上都有一个物理存储编号。</p>
</li>
<li>
<p>Tip3：在mysql当中，索引是一个单独的对象，在不同的存储引擎中以不同的形式存在，在MyISAM存储引擎中，索引存储在一个.MYI文件中。在InnoDB存储引擎中索引存储在一个逻辑名称叫做tablespace当中。在MEMORY存储引擎当中索引被存储在内存当中。不管索引存储在哪里，索引在mysql当中都是一个<strong>树的形式</strong>。</p>
</li>
</ul>
<p><strong>什么条件下</strong>会考虑给字段添加索引：</p>
<ol>
<li>数据量庞大。</li>
<li>该字段经常出现在where的后面，以<strong>条件</strong>的形式存在，也就是说<strong>这个字段总是被扫描</strong>。</li>
<li>该字段有很少的<strong>DML</strong>(insert delete update)操作。（因为DML之后，索引需要重新排序）</li>
</ol>
<ul>
<li>建议不要随意添加索引，因为索引也是需要维护的，太多的话反而会降低系统的性能。</li>
<li><strong>建议通过主键查询</strong>，建议通过unique约束的字段进行查询，效率是比较高的。</li>
</ul>
<h3 id="11-1索引的创建和删除"><a class="header-anchor" href="#11-1索引的创建和删除">¶</a>11.1索引的创建和删除</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">创建索引：</span><br><span class="line">	mysql<span class="operator">&gt;</span> <span class="keyword">create</span> index emp_ename_index <span class="keyword">on</span> emp(ename);</span><br><span class="line">	<span class="comment">-- 给emp表的ename字段添加索引，起名：emp_ename_index</span></span><br><span class="line">删除索引：</span><br><span class="line">	mysql<span class="operator">&gt;</span> <span class="keyword">drop</span> index emp_ename_index <span class="keyword">on</span> emp;</span><br><span class="line">	<span class="comment">-- 将emp表上的emp_ename_index索引删除。</span></span><br><span class="line">修改索引：</span><br><span class="line">     mysql<span class="operator">&gt;</span> <span class="keyword">alter</span> index emp_ename_index rename <span class="keyword">to</span> new_index;</span><br><span class="line">     <span class="comment">-- 对旧索引重新命名</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">-- 查看一个SQL语句是否使用了索引进行检索</span></span><br><span class="line">	mysql<span class="operator">&gt;</span> explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="operator">=</span> <span class="string">&#x27;KING&#x27;</span>;</span><br><span class="line">	<span class="operator">+</span><span class="comment">----+-------------+-------+------+---------------+------+---------+--</span></span><br><span class="line">	<span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span> <span class="operator">|</span> type <span class="operator">|</span> possible_keys <span class="operator">|</span> key  <span class="operator">|</span> key_len <span class="operator">|</span> 。。。</span><br><span class="line">	<span class="operator">+</span><span class="comment">----+-------------+-------+------+---------------+------+---------+-</span></span><br><span class="line">	<span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> emp   <span class="operator">|</span> <span class="keyword">ALL</span>  <span class="operator">|</span> <span class="keyword">NULL</span>          <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span> 。。。</span><br><span class="line">	<span class="operator">+</span><span class="comment">----+-------------+-------+------+---------------+------+---------+--</span></span><br><span class="line">	type<span class="operator">=</span><span class="keyword">ALL</span></span><br><span class="line">	扫描<span class="number">14</span>条记录，说明没有使用索引。<span class="comment">-- 后面没有截取到row</span></span><br><span class="line"></span><br><span class="line">	mysql<span class="operator">&gt;</span> <span class="keyword">create</span> index emp_ename_index <span class="keyword">on</span> emp(ename);</span><br><span class="line">	mysql<span class="operator">&gt;</span> explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="operator">=</span> <span class="string">&#x27;KING&#x27;</span>;</span><br><span class="line">	<span class="operator">+</span><span class="comment">----+-------------+-------+------+-----------------+-----------------</span></span><br><span class="line">	<span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span> <span class="operator">|</span> type <span class="operator">|</span> possible_keys   <span class="operator">|</span> key             。。。</span><br><span class="line">	<span class="operator">+</span><span class="comment">----+-------------+-------+------+-----------------+-----------------</span></span><br><span class="line">	<span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> emp   <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> emp_ename_index <span class="operator">|</span> emp_ename_index 。。。</span><br><span class="line">	<span class="operator">+</span><span class="comment">----+-------------+-------+------+-----------------+-----------------</span></span><br><span class="line">	type<span class="operator">=</span><span class="keyword">ref</span></span><br><span class="line">	扫描到<span class="number">1</span>条记录，说明使用了索引。<span class="comment">-- 后面没有截取到row</span></span><br></pre></td></tr></table></figure>
<h3 id="11-2索引失效"><a class="header-anchor" href="#11-2索引失效">¶</a>11.2索引失效</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">失效的第<span class="number">1</span>种情况：模糊匹配</span><br><span class="line">	<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="keyword">like</span> <span class="string">&#x27;%T&#x27;</span>;</span><br><span class="line">    <span class="comment">/*ename上即使添加了索引，也不会走索引</span></span><br><span class="line"><span class="comment">	原因是因为模糊匹配当中以“%”开头，任意一个数据都可被查到。</span></span><br><span class="line"><span class="comment">	所以尽量避免模糊查询的时候以“%”开始*/</span></span><br><span class="line">	mysql<span class="operator">&gt;</span> explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="keyword">like</span> <span class="string">&#x27;%T&#x27;</span>;</span><br><span class="line">	<span class="operator">+</span><span class="comment">----+-------------+-------+------+---------------+------+---------+--</span></span><br><span class="line">	<span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span> <span class="operator">|</span> type <span class="operator">|</span> possible_keys <span class="operator">|</span> key  <span class="operator">|</span> key_len <span class="operator">|</span> </span><br><span class="line">	<span class="operator">+</span><span class="comment">----+-------------+-------+------+---------------+------+---------+--</span></span><br><span class="line">	<span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> emp   <span class="operator">|</span> <span class="keyword">ALL</span>  <span class="operator">|</span> <span class="keyword">NULL</span>          <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span> </span><br><span class="line">	<span class="operator">+</span><span class="comment">----+-------------+-------+------+---------------+------+---------+--</span></span><br><span class="line">type<span class="operator">=</span><span class="keyword">ALL</span>,没有使用索引。</span><br><span class="line"></span><br><span class="line">失效的第<span class="number">2</span>种情况：使用<span class="keyword">or</span>且只有一端有索引</span><br><span class="line">	<span class="comment">/*如果使用or，那么要求or两端的条件字段都要有索引，才会走索引，</span></span><br><span class="line"><span class="comment">	如果其中一边有一个字段没有索引，那么另一个字段上的索引也不会实现。*/</span></span><br><span class="line">	mysql<span class="operator">&gt;</span> explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> ename <span class="operator">=</span> <span class="string">&#x27;KING&#x27;</span> <span class="keyword">or</span> job <span class="operator">=</span> <span class="string">&#x27;MANAGER&#x27;</span>;</span><br><span class="line">	<span class="operator">+</span><span class="comment">----+-------------+-------+------+-----------------+------+---------</span></span><br><span class="line">	<span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span> <span class="operator">|</span> type <span class="operator">|</span> possible_keys   <span class="operator">|</span> key  <span class="operator">|</span> key_len <span class="operator">|</span> </span><br><span class="line">	<span class="operator">+</span><span class="comment">----+-------------+-------+------+-----------------+------+---------</span></span><br><span class="line">	<span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> emp   <span class="operator">|</span> <span class="keyword">ALL</span>  <span class="operator">|</span> emp_ename_index <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span> </span><br><span class="line">	<span class="operator">+</span><span class="comment">----+-------------+-------+------+-----------------+------+---------</span></span><br><span class="line">type<span class="operator">=</span><span class="keyword">ALL</span>,没有使用索引。</span><br><span class="line"></span><br><span class="line">失效的第<span class="number">3</span>种情况：使用复合索引时没有用左侧的字段查询</span><br><span class="line">	<span class="comment">/*复合索引：</span></span><br><span class="line"><span class="comment">		两个字段，或者更多的字段联合起来添加一个索引，叫做复合索引。*/</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">create</span> index emp_job_sal_index <span class="keyword">on</span> emp(job,sal); <span class="comment">-- 只有使用job字段才能使用索引</span></span><br><span class="line">	</span><br><span class="line">	mysql<span class="operator">&gt;</span> explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> job <span class="operator">=</span> <span class="string">&#x27;MANAGER&#x27;</span>;</span><br><span class="line">	<span class="operator">+</span><span class="comment">----+-------------+-------+------+-------------------+---------------</span></span><br><span class="line">	<span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span> <span class="operator">|</span> type <span class="operator">|</span> possible_keys     <span class="operator">|</span> key           </span><br><span class="line">	<span class="operator">+</span><span class="comment">----+-------------+-------+------+-------------------+---------------</span></span><br><span class="line">	<span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> emp   <span class="operator">|</span> <span class="keyword">ref</span>  <span class="operator">|</span> emp_job_sal_index <span class="operator">|</span> </span><br><span class="line">	<span class="operator">+</span><span class="comment">----+-------------+-------+------+-------------------+---------------</span></span><br><span class="line">	type<span class="operator">=</span><span class="keyword">ref</span>，使用了索引。</span><br><span class="line">	</span><br><span class="line">	mysql<span class="operator">&gt;</span> explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> sal <span class="operator">=</span> <span class="number">800</span>; <span class="comment">-- 使用sal字段</span></span><br><span class="line">	<span class="operator">+</span><span class="comment">----+-------------+-------+------+---------------+------+---------+--</span></span><br><span class="line">	<span class="operator">|</span> id <span class="operator">|</span> select_type <span class="operator">|</span> <span class="keyword">table</span> <span class="operator">|</span> type <span class="operator">|</span> possible_keys <span class="operator">|</span> key  <span class="operator">|</span> key_len <span class="operator">|</span> </span><br><span class="line">	<span class="operator">+</span><span class="comment">----+-------------+-------+------+---------------+------+---------+--</span></span><br><span class="line">	<span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> SIMPLE      <span class="operator">|</span> emp   <span class="operator">|</span> <span class="keyword">ALL</span>  <span class="operator">|</span> <span class="keyword">NULL</span>          <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span> </span><br><span class="line">	<span class="operator">+</span><span class="comment">----+-------------+-------+------+---------------+------+---------+--</span></span><br><span class="line">	type<span class="operator">=</span><span class="keyword">ALL</span>,没有使用索引。</span><br></pre></td></tr></table></figure>
<h2 id="12-视图"><a class="header-anchor" href="#12-视图">¶</a>12.视图</h2>
<p>视图view:站在不同的角度去看待同一份数据。</p>
<p>基本表删除后，由该基本表导出的所有视图均无法使用。但是视图的定义没有从数据字典中清除，需要显式地使用drop view语句。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 表复制：</span></span><br><span class="line">	mysql<span class="operator">&gt;</span> <span class="keyword">create</span> <span class="keyword">table</span> dept2 <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dept; <span class="comment">-- 快速复制</span></span><br><span class="line"><span class="comment">-- dept2表中的数据：</span></span><br><span class="line">	mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dept2;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------+------------+----------+</span></span><br><span class="line"><span class="operator">|</span> DEPTNO <span class="operator">|</span> DNAME      <span class="operator">|</span> LOC      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+------------+----------+</span></span><br><span class="line"><span class="operator">|</span>     <span class="number">10</span> <span class="operator">|</span> ACCOUNTING <span class="operator">|</span> <span class="keyword">NEW</span> YORK <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>     <span class="number">20</span> <span class="operator">|</span> RESEARCH   <span class="operator">|</span> DALLAS   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>     <span class="number">30</span> <span class="operator">|</span> SALES      <span class="operator">|</span> CHICAGO  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>     <span class="number">40</span> <span class="operator">|</span> OPERATIONS <span class="operator">|</span> BOSTON   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+------------+----------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建视图对象：</span></span><br><span class="line">	<span class="keyword">create</span> <span class="keyword">view</span> dept2_view <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dept2;</span><br><span class="line"><span class="comment">-- 删除视图对象：</span></span><br><span class="line">	<span class="keyword">drop</span> <span class="keyword">view</span> dept2_view;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 注意：只有DQL语句才能以view的形式创建。</span></span><br><span class="line">	<span class="keyword">create</span> <span class="keyword">view</span> view_name <span class="keyword">as</span> <span class="comment">-- 这里的语句必须是DQL语句，也就是select语句;</span></span><br></pre></td></tr></table></figure>
<h3 id="12-1视图的作用"><a class="header-anchor" href="#12-1视图的作用">¶</a>12.1视图的作用</h3>
<p>我们可以面向视图对象进行增删改查。</p>
<p>对视图对象的增删改查，<strong>会导致原表也被改动</strong>，会影响到原表中的数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 面向视图查询</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dept2_view; </span><br><span class="line"></span><br><span class="line"><span class="comment">-- 面向视图插入数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> dept2_view(deptno,dname,loc) <span class="keyword">values</span>(<span class="number">60</span>,<span class="string">&#x27;SALES&#x27;</span>, <span class="string">&#x27;BEIJING&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询原表数据</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dept2; <span class="comment">-- 原表也被插入数据</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+------------+----------+</span></span><br><span class="line"><span class="operator">|</span> DEPTNO <span class="operator">|</span> DNAME      <span class="operator">|</span> LOC      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+------------+----------+</span></span><br><span class="line"><span class="operator">|</span>     <span class="number">10</span> <span class="operator">|</span> ACCOUNTING <span class="operator">|</span> <span class="keyword">NEW</span> YORK <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>     <span class="number">20</span> <span class="operator">|</span> RESEARCH   <span class="operator">|</span> DALLAS   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>     <span class="number">30</span> <span class="operator">|</span> SALES      <span class="operator">|</span> CHICAGO  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>     <span class="number">40</span> <span class="operator">|</span> OPERATIONS <span class="operator">|</span> BOSTON   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>     <span class="number">60</span> <span class="operator">|</span> SALES      <span class="operator">|</span> BEIJING  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+------------+----------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 面向视图删除</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">delete</span> <span class="keyword">from</span> dept2_view;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询原表数据</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> dept2; <span class="comment">-- 原表也被删除</span></span><br><span class="line"><span class="keyword">Empty</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"><span class="comment">-- 创建视图对象</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> </span><br><span class="line">	emp_dept_view <span class="comment">-- 使以后的表操作更加简单，便利</span></span><br><span class="line"><span class="keyword">as</span></span><br><span class="line">	<span class="keyword">select</span> </span><br><span class="line">		e.ename,e.sal,d.dname</span><br><span class="line">	<span class="keyword">from</span></span><br><span class="line">		emp e</span><br><span class="line">	<span class="keyword">join</span></span><br><span class="line">		dept d</span><br><span class="line">	<span class="keyword">on</span></span><br><span class="line">		e.deptno <span class="operator">=</span> d.deptno; <span class="comment">-- 将emp表和dept表连接后的表作为视图</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询视图对象</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp_dept_view;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------+---------+------------+</span></span><br><span class="line"><span class="operator">|</span> ename  <span class="operator">|</span> sal     <span class="operator">|</span> dname      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+---------+------------+</span></span><br><span class="line"><span class="operator">|</span> CLARK  <span class="operator">|</span> <span class="number">2450.00</span> <span class="operator">|</span> ACCOUNTING <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> KING   <span class="operator">|</span> <span class="number">5000.00</span> <span class="operator">|</span> ACCOUNTING <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MILLER <span class="operator">|</span> <span class="number">1300.00</span> <span class="operator">|</span> ACCOUNTING <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> SMITH  <span class="operator">|</span>  <span class="number">800.00</span> <span class="operator">|</span> RESEARCH   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> JONES  <span class="operator">|</span> <span class="number">2975.00</span> <span class="operator">|</span> RESEARCH   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> SCOTT  <span class="operator">|</span> <span class="number">3000.00</span> <span class="operator">|</span> RESEARCH   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> ADAMS  <span class="operator">|</span> <span class="number">1100.00</span> <span class="operator">|</span> RESEARCH   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> FORD   <span class="operator">|</span> <span class="number">3000.00</span> <span class="operator">|</span> RESEARCH   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> ALLEN  <span class="operator">|</span> <span class="number">1600.00</span> <span class="operator">|</span> SALES      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> WARD   <span class="operator">|</span> <span class="number">1250.00</span> <span class="operator">|</span> SALES      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MARTIN <span class="operator">|</span> <span class="number">1250.00</span> <span class="operator">|</span> SALES      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> BLAKE  <span class="operator">|</span> <span class="number">2850.00</span> <span class="operator">|</span> SALES      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> TURNER <span class="operator">|</span> <span class="number">1500.00</span> <span class="operator">|</span> SALES      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> JAMES  <span class="operator">|</span>  <span class="number">950.00</span> <span class="operator">|</span> SALES      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+---------+------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 面向视图更新</span></span><br><span class="line"><span class="keyword">update</span> emp_dept_view </span><br><span class="line"><span class="keyword">set</span> sal <span class="operator">=</span> <span class="number">1000</span> </span><br><span class="line"><span class="keyword">where</span> dname <span class="operator">=</span> <span class="string">&#x27;ACCOUNTING&#x27;</span></span><br><span class="line"><span class="keyword">with</span> <span class="keyword">check</span> option; <span class="comment">-- 对该视图进行更新操作时，会自动检查where子句的条件。同样适用于插入和删除操作。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 原表数据被更新</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+--------+-----------+------+------------+---------+---------+----</span></span><br><span class="line"><span class="operator">|</span> EMPNO <span class="operator">|</span> ENAME  <span class="operator">|</span> JOB       <span class="operator">|</span> MGR  <span class="operator">|</span> HIREDATE   <span class="operator">|</span> SAL     <span class="operator">|</span> COMM    <span class="operator">|</span> </span><br><span class="line"><span class="operator">+</span><span class="comment">-------+--------+-----------+------+------------+---------+---------+----</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">7369</span> <span class="operator">|</span> SMITH  <span class="operator">|</span> CLERK     <span class="operator">|</span> <span class="number">7902</span> <span class="operator">|</span> <span class="number">1980</span><span class="number">-12</span><span class="number">-17</span> <span class="operator">|</span>  <span class="number">800.00</span> <span class="operator">|</span>    <span class="keyword">NULL</span> <span class="operator">|</span>     </span><br><span class="line"><span class="operator">|</span>  <span class="number">7499</span> <span class="operator">|</span> ALLEN  <span class="operator">|</span> SALESMAN  <span class="operator">|</span> <span class="number">7698</span> <span class="operator">|</span> <span class="number">1981</span><span class="number">-02</span><span class="number">-20</span> <span class="operator">|</span> <span class="number">1600.00</span> <span class="operator">|</span>  <span class="number">300.00</span> <span class="operator">|</span>     </span><br><span class="line"><span class="operator">|</span>  <span class="number">7521</span> <span class="operator">|</span> WARD   <span class="operator">|</span> SALESMAN  <span class="operator">|</span> <span class="number">7698</span> <span class="operator">|</span> <span class="number">1981</span><span class="number">-02</span><span class="number">-22</span> <span class="operator">|</span> <span class="number">1250.00</span> <span class="operator">|</span>  <span class="number">500.00</span> <span class="operator">|</span>     </span><br><span class="line"><span class="operator">|</span>  <span class="number">7566</span> <span class="operator">|</span> JONES  <span class="operator">|</span> MANAGER   <span class="operator">|</span> <span class="number">7839</span> <span class="operator">|</span> <span class="number">1981</span><span class="number">-04</span><span class="number">-02</span> <span class="operator">|</span> <span class="number">2975.00</span> <span class="operator">|</span>    <span class="keyword">NULL</span> <span class="operator">|</span>     </span><br><span class="line"><span class="operator">|</span>  <span class="number">7654</span> <span class="operator">|</span> MARTIN <span class="operator">|</span> SALESMAN  <span class="operator">|</span> <span class="number">7698</span> <span class="operator">|</span> <span class="number">1981</span><span class="number">-09</span><span class="number">-28</span> <span class="operator">|</span> <span class="number">1250.00</span> <span class="operator">|</span> <span class="number">1400.00</span> <span class="operator">|</span>     </span><br><span class="line"><span class="operator">|</span>  <span class="number">7698</span> <span class="operator">|</span> BLAKE  <span class="operator">|</span> MANAGER   <span class="operator">|</span> <span class="number">7839</span> <span class="operator">|</span> <span class="number">1981</span><span class="number">-05</span><span class="number">-01</span> <span class="operator">|</span> <span class="number">2850.00</span> <span class="operator">|</span>    <span class="keyword">NULL</span> <span class="operator">|</span>     </span><br><span class="line"><span class="operator">|</span>  <span class="number">7782</span> <span class="operator">|</span> CLARK  <span class="operator">|</span> MANAGER   <span class="operator">|</span> <span class="number">7839</span> <span class="operator">|</span> <span class="number">1981</span><span class="number">-06</span><span class="number">-09</span> <span class="operator">|</span> <span class="number">1000.00</span> <span class="operator">|</span>    <span class="keyword">NULL</span> <span class="operator">|</span>     </span><br><span class="line"><span class="operator">|</span>  <span class="number">7788</span> <span class="operator">|</span> SCOTT  <span class="operator">|</span> ANALYST   <span class="operator">|</span> <span class="number">7566</span> <span class="operator">|</span> <span class="number">1987</span><span class="number">-04</span><span class="number">-19</span> <span class="operator">|</span> <span class="number">3000.00</span> <span class="operator">|</span>    <span class="keyword">NULL</span> <span class="operator">|</span>     </span><br><span class="line"><span class="operator">|</span>  <span class="number">7839</span> <span class="operator">|</span> KING   <span class="operator">|</span> PRESIDENT <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="number">1981</span><span class="number">-11</span><span class="number">-17</span> <span class="operator">|</span> <span class="number">1000.00</span> <span class="operator">|</span>    <span class="keyword">NULL</span> <span class="operator">|</span>     </span><br><span class="line"><span class="operator">|</span>  <span class="number">7844</span> <span class="operator">|</span> TURNER <span class="operator">|</span> SALESMAN  <span class="operator">|</span> <span class="number">7698</span> <span class="operator">|</span> <span class="number">1981</span><span class="number">-09</span><span class="number">-08</span> <span class="operator">|</span> <span class="number">1500.00</span> <span class="operator">|</span>    <span class="number">0.00</span> <span class="operator">|</span>     </span><br><span class="line"><span class="operator">|</span>  <span class="number">7876</span> <span class="operator">|</span> ADAMS  <span class="operator">|</span> CLERK     <span class="operator">|</span> <span class="number">7788</span> <span class="operator">|</span> <span class="number">1987</span><span class="number">-05</span><span class="number">-23</span> <span class="operator">|</span> <span class="number">1100.00</span> <span class="operator">|</span>    <span class="keyword">NULL</span> <span class="operator">|</span>     </span><br><span class="line"><span class="operator">|</span>  <span class="number">7900</span> <span class="operator">|</span> JAMES  <span class="operator">|</span> CLERK     <span class="operator">|</span> <span class="number">7698</span> <span class="operator">|</span> <span class="number">1981</span><span class="number">-12</span><span class="number">-03</span> <span class="operator">|</span>  <span class="number">950.00</span> <span class="operator">|</span>    <span class="keyword">NULL</span> <span class="operator">|</span>     </span><br><span class="line"><span class="operator">|</span>  <span class="number">7902</span> <span class="operator">|</span> FORD   <span class="operator">|</span> ANALYST   <span class="operator">|</span> <span class="number">7566</span> <span class="operator">|</span> <span class="number">1981</span><span class="number">-12</span><span class="number">-03</span> <span class="operator">|</span> <span class="number">3000.00</span> <span class="operator">|</span>    <span class="keyword">NULL</span> <span class="operator">|</span>     </span><br><span class="line"><span class="operator">|</span>  <span class="number">7934</span> <span class="operator">|</span> MILLER <span class="operator">|</span> CLERK     <span class="operator">|</span> <span class="number">7782</span> <span class="operator">|</span> <span class="number">1982</span><span class="number">-01</span><span class="number">-23</span> <span class="operator">|</span> <span class="number">1000.00</span> <span class="operator">|</span>    <span class="keyword">NULL</span> <span class="operator">|</span>     </span><br><span class="line"><span class="operator">+</span><span class="comment">-------+--------+-----------+------+------------+---------+---------+----</span></span><br></pre></td></tr></table></figure>
<h3 id="12-2视图在开发中的作用"><a class="header-anchor" href="#12-2视图在开发中的作用">¶</a>12.2视图在开发中的作用</h3>
<p>假设<strong>有一条非常复杂的SQL语句</strong>，而这条SQL语句需要在不同的位置上<strong>反复使用</strong>。</p>
<p>每一次使用这个sql语句的时候都需要重新编写，很长，很麻烦，怎么办？</p>
<p>可以把这条复杂的SQL语句以视图对象的形式新建，在需要编写这条SQL语句的位置直接使用视图对象，可以大大<strong>简化开发</strong>，并且利于后期的维护，修改数据的时候也只需要修改视图。</p>
<p>可以对视图进行增删改查等操作。视图不是在内存当中，视图对象也是以文件形式<strong>存储在硬盘上的，不会消失</strong>。</p>
<p>视图并不等同于派生表。</p>
<h2 id="13-数据库三范式"><a class="header-anchor" href="#13-数据库三范式">¶</a>13.数据库三范式</h2>
<p><strong>第一范式</strong>：要求任何一张表<strong>必须有主键</strong>，每一个<strong>字段</strong>原子性<strong>不可再分</strong>。</p>
<p><strong>第二范式</strong>：建立在第一范式的基础之上，要求所有非主键字段<strong>完全依赖主键</strong>，<br>
<strong>不要产生部分依赖</strong>。</p>
<p><strong>第三范式</strong>：建立在第二范式的基础之上，要求所有非主键字段<strong>直接依赖主键</strong>，<br>
<strong>不要产生传递依赖</strong>。</p>
<p>设计数据库表的时候，按照以上的范式进行，可以避免表中数据的冗余，空间的浪费。</p>
<h3 id="13-1第一范式"><a class="header-anchor" href="#13-1第一范式">¶</a>13.1第一范式</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">学生编号    学生姓名    联系方式</span><br><span class="line"><span class="comment">------------------------------------------------</span></span><br><span class="line"><span class="number">1001</span>		张三		zs<span class="variable">@gmail</span>.com,<span class="number">1359999999</span></span><br><span class="line"><span class="number">1002</span>		李四		ls<span class="variable">@gmail</span>.com,<span class="number">13699999999</span></span><br><span class="line"><span class="number">1001</span>		王五		ww<span class="variable">@163</span>.net,<span class="number">13488888888</span></span><br><span class="line">	</span><br><span class="line">以上是学生表，满足第一范式吗？</span><br><span class="line">	不满足。第一：没有主键；第二：联系方式可以分为邮箱地址和电话</span><br><span class="line">修改：</span><br><span class="line">学生编号(pk)          学生姓名	 邮箱地址		 联系电话</span><br><span class="line"><span class="comment">------------------------------------------------------------</span></span><br><span class="line"><span class="number">1001</span>				张三		zs<span class="variable">@gmail</span>.com	<span class="number">1359999999</span></span><br><span class="line"><span class="number">1002</span>				李四		ls<span class="variable">@gmail</span>.com	<span class="number">13699999999</span></span><br><span class="line"><span class="number">1003</span>				王五		ww<span class="variable">@163</span>.net		<span class="number">13488888888</span></span><br></pre></td></tr></table></figure>
<h3 id="13-2第二范式"><a class="header-anchor" href="#13-2第二范式">¶</a>13.2第二范式</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">学生编号 		学生姓名 	教师编号 教师姓名</span><br><span class="line"><span class="comment">----------------------------------------------------</span></span><br><span class="line"><span class="number">1001</span>			张三		<span class="number">001</span>		王老师</span><br><span class="line"><span class="number">1002</span>			李四		<span class="number">002</span>		赵老师</span><br><span class="line"><span class="number">1003</span>			王五		<span class="number">001</span>		王老师</span><br><span class="line"><span class="number">1001</span>			张三		<span class="number">002</span>		赵老师</span><br><span class="line">这张表描述了学生和老师的关系：<span class="number">1</span>个学生有多个老师，<span class="number">1</span>个老师有多个学生</span><br><span class="line">这是非常典型的`多对多`关系</span><br><span class="line"></span><br><span class="line">以上的表是否满足第一范式？</span><br><span class="line">没有主键，不满足第一范式</span><br><span class="line"></span><br><span class="line">修改：</span><br><span class="line">学生编号<span class="operator">+</span>教师编号(pk)		       学生姓名       教师姓名</span><br><span class="line"><span class="comment">----------------------------------------------------------</span></span><br><span class="line"><span class="number">1001</span>			<span class="number">001</span>				张三			王老师</span><br><span class="line"><span class="number">1002</span>			<span class="number">002</span>				李四			赵老师</span><br><span class="line"><span class="number">1003</span>			<span class="number">001</span>				王五			王老师</span><br><span class="line"><span class="number">1001</span>			<span class="number">002</span>				张三			赵老师</span><br><span class="line">学生编号和教师编号，两个字段联合做主键——复合主键</span><br><span class="line"></span><br><span class="line">以上的表是否满足第二范式？</span><br><span class="line">不满足，“张三”依赖<span class="number">1001</span>，“王老师”依赖<span class="number">001</span>，显然产生了部分依赖。</span><br><span class="line"></span><br><span class="line">产生部分依赖有什么缺点？</span><br><span class="line">数据冗余了，空间浪费了。“张三”重复了，“王老师”重复了。</span><br><span class="line"></span><br><span class="line">修改：</span><br><span class="line">使用三张表来表示`多对多`的关系</span><br><span class="line">学生表</span><br><span class="line">学生编号(pk)		     学生名字</span><br><span class="line"><span class="comment">------------------------------------</span></span><br><span class="line"><span class="number">1001</span>					张三</span><br><span class="line"><span class="number">1002</span>					李四</span><br><span class="line"><span class="number">1003</span>					王五</span><br><span class="line"></span><br><span class="line">教师表</span><br><span class="line">教师编号(pk)		 教师姓名</span><br><span class="line"><span class="comment">--------------------------------------</span></span><br><span class="line"><span class="number">001</span>					王老师</span><br><span class="line"><span class="number">002</span>					赵老师</span><br><span class="line"></span><br><span class="line">学生教师关系表</span><br><span class="line">id(pk)			        学生编号(fk)			      教师编号(fk)</span><br><span class="line"><span class="comment">-------------------------------------------------------------------</span></span><br><span class="line"><span class="number">1</span>						<span class="number">1001</span>						<span class="number">001</span></span><br><span class="line"><span class="number">2</span>						<span class="number">1002</span>						<span class="number">002</span></span><br><span class="line"><span class="number">3</span>						<span class="number">1003</span>						<span class="number">001</span></span><br><span class="line"><span class="number">4</span>						<span class="number">1001</span>						<span class="number">002</span></span><br></pre></td></tr></table></figure>
<p>多对多，要使用三张表，关系表中要有两个外键。</p>
<h3 id="13-3第三范式"><a class="header-anchor" href="#13-3第三范式">¶</a>13.3第三范式</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">学生编号（PK） 	    学生姓名   班级编号  	 班级名称</span><br><span class="line"><span class="comment">---------------------------------------------------------</span></span><br><span class="line"><span class="number">1001</span>				张三		<span class="number">01</span>			一年一班</span><br><span class="line"><span class="number">1002</span>				李四		<span class="number">02</span>			一年二班</span><br><span class="line"><span class="number">1003</span>				王五		<span class="number">03</span>			一年三班</span><br><span class="line"><span class="number">1004</span>				赵六		<span class="number">03</span>			一年三班</span><br><span class="line"></span><br><span class="line">以上表的设计是描述班级和学生的关系，很显然是`<span class="number">1</span>对多`关系。</span><br><span class="line">一个班级有多个学生。</span><br><span class="line"></span><br><span class="line">以上表是否满足第一范式？</span><br><span class="line">满足第一范式，有主键。</span><br><span class="line"></span><br><span class="line">以上表是否满足第二范式？</span><br><span class="line">满足第二范式，因为主键不是复合主键，没有产生部分依赖。主键是单一主键。</span><br><span class="line"></span><br><span class="line">分析以上表是否满足第三范式？</span><br><span class="line">第三范式要求：不要产生传递依赖</span><br><span class="line">一年一班依赖<span class="number">01</span>，<span class="number">01</span>依赖<span class="number">1001</span>，产生了传递依赖</span><br><span class="line">不符合第三范式的要求，产生了数据的冗余</span><br><span class="line"></span><br><span class="line">修改：</span><br><span class="line">班级表：一</span><br><span class="line">班级编号(pk)				      班级名称</span><br><span class="line"><span class="comment">-------------------------------------------</span></span><br><span class="line"><span class="number">01</span>								一年一班</span><br><span class="line"><span class="number">02</span>								一年二班</span><br><span class="line"><span class="number">03</span>								一年三班</span><br><span class="line"></span><br><span class="line">学生表：多</span><br><span class="line">学生编号（PK）        学生姓名       班级编号(fk)</span><br><span class="line"><span class="comment">--------------------------------------------</span></span><br><span class="line"><span class="number">1001</span>				张三			<span class="number">01</span>			</span><br><span class="line"><span class="number">1002</span>				李四			<span class="number">02</span>			</span><br><span class="line"><span class="number">1003</span>				王五			<span class="number">03</span>			</span><br><span class="line"><span class="number">1004</span>				赵六			<span class="number">03</span>		</span><br></pre></td></tr></table></figure>
<p>一对多，使用两张表，对应多的表加外键。</p>
<p>如果有一张字段很多，数据庞大的表，建议把一张表拆成两张，其中一张表的字段添加上外键和唯一性约束。（fk+unique）</p>
<p><strong>关于三范式的实际使用</strong></p>
<p>数据库三范式是理论上的，实践和理论有时候会存在偏差。</p>
<p>最终目的都是为了满足客户的需求，有的时候会拿冗余换执行速度。</p>
<p>因为在sql当中，<strong>表和表之间连接次数越多，效率越低。（笛卡尔积）</strong></p>
<p><strong>有时候可能会存在冗余，但是为了减少表的连接次数，这样做也是合理的，并且对于开发人员来说，sql语句的编写难度也会降低。</strong></p>
<hr>
<h2 id="14-DBA常用命令"><a class="header-anchor" href="#14-DBA常用命令">¶</a>14.DBA常用命令</h2>
<p><img src="http://villagerain.oss-cn-huhehaote.aliyuncs.com/imgSnipaste_2024-03-26_10-54-44.png" alt=""></p>
<h2 id="15-自主存取控制"><a class="header-anchor" href="#15-自主存取控制">¶</a>15.自主存取控制</h2>
<h3 id="15-1授予权限grant"><a class="header-anchor" href="#15-1授予权限grant">¶</a>15.1授予权限grant</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 把查询Student表的权限授给用户U1</span></span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">select</span></span><br><span class="line"><span class="keyword">on</span> <span class="keyword">table</span> Student</span><br><span class="line"><span class="keyword">to</span> U1</span><br><span class="line"><span class="keyword">with</span> <span class="keyword">grant</span> option; <span class="comment">-- 允许该用户把这种权限再授予给其他用户</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 把Student表的全部操作权限授予给用户U2和用户U3</span></span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> privileges</span><br><span class="line"><span class="keyword">on</span> <span class="keyword">table</span> Student</span><br><span class="line"><span class="keyword">to</span> U2,U3;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 把查询Student表的权限授给所有用户</span></span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">select</span></span><br><span class="line"><span class="keyword">on</span> <span class="keyword">table</span> Student</span><br><span class="line"><span class="keyword">to</span> public;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 把查询Student表和修改学号的权限授给用户U4</span></span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">select</span>,<span class="keyword">update</span>(Sno)</span><br><span class="line"><span class="keyword">on</span> <span class="keyword">table</span> Student</span><br><span class="line"><span class="keyword">to</span> U1;</span><br></pre></td></tr></table></figure>
<h3 id="15-2收回权限revoke"><a class="header-anchor" href="#15-2收回权限revoke">¶</a>15.2收回权限revoke</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 把用户U4修改学号的权限收回</span></span><br><span class="line"><span class="keyword">revoke</span> <span class="keyword">update</span>(sno)</span><br><span class="line"><span class="keyword">on</span> <span class="keyword">table</span> Student</span><br><span class="line"><span class="keyword">from</span> U4;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 收回所有用户对Student表的查询权限</span></span><br><span class="line"><span class="keyword">revoke</span> <span class="keyword">select</span></span><br><span class="line"><span class="keyword">on</span> <span class="keyword">table</span> Student</span><br><span class="line"><span class="keyword">from</span> public;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 可以在用户名后加cascade，表示级联收回该用户及其赋予用户的权限</span></span><br></pre></td></tr></table></figure>
<h3 id="15-3创建数据库的权限"><a class="header-anchor" href="#15-3创建数据库的权限">¶</a>15.3创建数据库的权限</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 首先以超级用户system登录,再创建超级用户system2</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> system2 </span><br><span class="line"><span class="keyword">with</span> superuser password <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建具有createdb权限的用户U1和普通用户U2</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> U1 </span><br><span class="line"><span class="keyword">with</span> createdb password <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> U2 </span><br><span class="line">password <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 以U1用户登录，创建数据库U1DB</span></span><br><span class="line"><span class="keyword">create</span> database U1DB;</span><br></pre></td></tr></table></figure>
<h3 id="15-4数据库角色"><a class="header-anchor" href="#15-4数据库角色">¶</a>15.4数据库角色</h3>
<p><strong>角色是权限的集合</strong>，可以为一组具有相同权限的用户创建一个角色。</p>
<p>使用角色来管理数据库权限<strong>可以简化授权的过程</strong>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建一个角色</span></span><br><span class="line"><span class="keyword">create</span> role R1;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使角色R1拥有Student表的select、update、insert权限</span></span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">select</span>,<span class="keyword">update</span>,<span class="keyword">insert</span></span><br><span class="line"><span class="keyword">on</span> <span class="keyword">table</span> Student</span><br><span class="line"><span class="keyword">to</span> R1;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 将角色R1授予王平、张明、赵玲，使他们具有角色R1所包含的全部权限</span></span><br><span class="line"><span class="keyword">grant</span> R1</span><br><span class="line"><span class="keyword">to</span> 王平、张明、赵玲;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 一次性收回王平的这三个权限</span></span><br><span class="line"><span class="keyword">revoke</span> R1</span><br><span class="line"><span class="keyword">from</span> 王平;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 给角色R1增加delete权限</span></span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">delete</span></span><br><span class="line"><span class="keyword">on</span> <span class="keyword">table</span> Student</span><br><span class="line"><span class="keyword">to</span> R1;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 收回角色R1的select权限</span></span><br><span class="line"><span class="keyword">revoke</span> <span class="keyword">select</span></span><br><span class="line"><span class="keyword">on</span> <span class="keyword">table</span> Student</span><br><span class="line"><span class="keyword">from</span> R1;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    
    
      <div>
      <div>
    
        <div style="text-align:center;color: #ccc;font-size:24px;">-------------本文结束-------------</div>
    
</div>
      </div>
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/MySQL/" rel="tag"># MySQL</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/02/23/%E5%A4%A7%E4%BA%8C%E4%B8%8B%E5%BC%80%E5%AD%A6%E5%89%8D%E7%9A%84%E6%80%BB%E7%BB%93%E4%B8%8E%E5%B1%95%E6%9C%9B/" rel="prev" title="大二下开学前的总结与展望">
                  <i class="fa fa-angle-left"></i> 大二下开学前的总结与展望
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/03/29/MySQL%E2%80%94%E2%80%9434%E9%81%93%E6%9F%A5%E8%AF%A2%E7%BB%83%E4%B9%A0%E9%A2%98/" rel="next" title="MySQL——34道查询练习题">
                  MySQL——34道查询练习题 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">村雨</span>
  </div>

<!-- 网站运行时间的设置 -->
<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("12/29/2023 10:00:00"); //此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒.";
    }
setInterval("createtime()",250);
</script>


    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script size="300" alpha="0.6" zIndex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  <script src="/js/third-party/pace.js"></script>


  




<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>

<script>
var options = {
  bottom: '32px',
  right: '32px',
  left: 'unset',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#100f2c',
  buttonColorLight: '#fff',
  saveInCookies: true,
  label: '🌓',
  autoMatchOsTheme: true
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
</script>

<script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>